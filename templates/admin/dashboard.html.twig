{% extends 'base.html.twig' %}

{% block title %}Admin Dashboard - Réclamations & Feedbacks{% endblock %}

{% block stylesheets %}
    <link href="https://fonts.googleapis.com/css?family=Inter:300,400,500,600,700,800" rel="stylesheet" />
    <link href="{{ asset('assets/css/nucleo-icons.css') }}" rel="stylesheet" />
    <link href="{{ asset('assets/css/nucleo-svg.css') }}" rel="stylesheet" />
    <link href="{{ asset('assets/css/soft-ui-dashboard.css') }}" rel="stylesheet" />
    <link href="{{ asset('assets/fontawesome/css/all.css') }}" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        body {
            background-color: #F9FAFB;
            font-family: 'Inter', sans-serif;
            color: #1F2A44;
        }
        .sidenav {
            background-color: #FFFFFF;
            width: 260px;
            height: 100vh;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
        }
        .sidenav-header {
            padding: 20px;
            border-bottom: 1px solid #E5E7EB;
        }
        .navbar-brand {
            display: flex;
            align-items: center;
            color: #1F2A44;
            transition: color 0.3s ease, transform 0.3s ease;
        }
        .navbar-brand:hover {
            color: #3B82F6;
            transform: scale(1.03);
        }
        .navbar-nav .nav-link {
            padding: 12px 20px;
            color: #6B7280;
            transition: all 0.3s ease;
            border-radius: 8px;
            margin: 5px 10px;
        }
        .navbar-nav .nav-link:hover {
            background-color: #3B82F6;
            color: #FFF;
            transform: translateX(5px);
        }
        .navbar-nav .nav-link.active {
            background-color: #3B82F6;
            color: #FFF;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);
        }
        .navbar-nav .nav-link .icon {
            width: 32px;
            height: 32px;
            background-color: #F9FAFB;
            border-radius: 6px;
            transition: background-color 0.3s ease, transform 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .navbar-nav .nav-link:hover .icon,
        .navbar-nav .nav-link.active .icon {
            background-color: #FFF;
            transform: rotate(360deg);
        }
        .navbar-nav .nav-link .icon i {
            font-size: 16px;
            color: #6B7280;
        }
        .navbar-nav .nav-link:hover .icon i,
        .navbar-nav .nav-link.active .icon i {
            color: #3B82F6;
        }
        .navbar-nav .dropdown-toggle::after {
            margin-left: 12px;
            transition: transform 0.3s ease;
        }
        .navbar-nav .dropdown-toggle[aria-expanded="true"]::after {
            transform: rotate(180deg);
        }
        .collapse {
            transition: all 0.3s ease;
        }
        .navbar-nav .collapse .nav-link {
            padding-left: 45px;
            font-size: 0.95em;
        }
        .navbar-nav .collapse .nav-link:hover {
            background-color: #10B981;
            color: #FFF;
        }
        hr.horizontal {
            border: 0;
            height: 1px;
            background-color: #E5E7EB;
            margin: 10px 0;
        }
        @media (max-width: 768px) {
            .sidenav {
                width: 220px;
            }
        }
        .main-content {
            margin-left: 260px;
            width: calc(100% - 260px);
            min-height: 100vh;
            padding: 40px;
            background-color: #F9FAFB;
        }
        @media (max-width: 768px) {
            .main-content {
                margin-left: 220px;
                width: calc(100% - 220px);
                padding: 20px;
            }
        }
        .module-section {
            background-color: #FFFFFF;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
            padding: 25px;
            margin-bottom: 40px;
        }
        .module-section h4 {
            color: #1F2A44;
            font-weight: 700;
            margin-bottom: 25px;
            border-bottom: 3px solid #3B82F6;
            padding-bottom: 12px;
            font-size: 1.5em;
        }
        .kpi-card {
            background-color: #FFF;
            border: none;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            min-height: 140px;
            transition: transform 0.4s ease, opacity 0.6s ease, box-shadow 0.4s ease;
            opacity: 0;
        }
        .kpi-card.animate {
            opacity: 1;
            transform: translateY(-5px);
        }
        .kpi-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }
        .kpi-card .card-body {
            padding: 20px;
        }
        .kpi-card .icon {
            background-color: #3B82F6;
            box-shadow: 0 3px 12px rgba(59, 130, 246, 0.3);
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .kpi-card h5 {
            color: #1F2A44;
            font-weight: 700;
            font-size: 1.8em;
            margin-top: 15px;
        }
        .kpi-card span.text-sm {
            color: #6B7280;
            font-size: 0.9em;
            font-weight: 500;
        }
        .kpi-card .trend {
            color: #6B7280;
            font-size: 0.85em;
            font-weight: 600;
        }
        .kpi-card .trend.positive {
            color: #10B981;
        }
        .kpi-card .trend.negative {
            color: #EF4444;
        }
        .chart-card {
            background-color: #FFF;
            border: none;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            min-height: 350px;
            height: auto; /* Ajusté pour contenu dynamique */
            transition: opacity 0.6s ease, transform 0.4s ease;
            opacity: 0;
            display: flex;
            flex-direction: column;
        }
        .chart-card.animate {
            opacity: 1;
            transform: translateY(-5px);
        }
        .chart-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }
        .chart-card .card-header {
            background-color: transparent;
            border-bottom: none;
            padding: 20px;
            flex-shrink: 0;
        }
        .chart-card .card-header h6 {
            color: #1F2A44;
            font-weight: 600;
            font-size: 1.1em;
            margin: 0;
        }
        .chart-card .card-body {
            padding: 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .chart-canvas {
            width: 100% !important;
            height: 250px !important;
            max-width: 100%;
            max-height: 250px;
        }
        .navbar-main {
            background-color: #FFFFFF;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
            margin-bottom: 30px;
            padding: 15px;
        }
        .navbar-main .breadcrumb {
            background-color: transparent;
            margin-bottom: 0;
        }
        .navbar-main .breadcrumb-item a,
        .navbar-main .breadcrumb-item {
            color: #6B7280;
            font-size: 0.9em;
        }
        .navbar-main .breadcrumb-item.active {
            color: #1F2A44;
            font-weight: 600;
        }
        .navbar-main h6 {
            color: #1F2A44;
            font-weight: 700;
            font-size: 1.3em;
        }
        .navbar-main .input-group {
            background-color: #E5E7EB;
            border-radius: 10px;
            max-width: 300px;
        }
        .navbar-main .input-group-text {
            background-color: transparent;
            border: none;
            color: #6B7280;
        }
        .navbar-main .form-control {
            background-color: transparent;
            border: none;
            color: #1F2A44;
            font-size: 0.95em;
        }
        .navbar-main .form-control::placeholder {
            color: #9CA3AF;
        }
        .navbar-main .nav-link {
            color: #1F2A44;
            font-weight: 600;
        }
        .navbar-main .nav-link:hover {
            color: #3B82F6;
        }
        .collapsible-section {
            margin-bottom: 40px;
        }
        .collapsible-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 15px 25px;
            background-color: #FFFFFF;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
            margin-bottom: 10px;
            transition: background-color 0.3s ease;
        }
        .collapsible-header:hover {
            background-color: #F9FAFB;
        }
        .collapsible-header h4 {
            margin: 0;
            color: #1F2A44;
            font-weight: 700;
            font-size: 1.5em;
            border-bottom: none;
            padding-bottom: 0;
        }
        .collapsible-content {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.5s ease;
        }
        .collapsible-content.active {
            padding: 25px;
            max-height: 3000px; /* Augmenté pour plus de contenu */
        }
        .toggle-icon {
            font-size: 1.2em;
            color: #3B82F6;
        }
        .toggle-icon.collapsed i::before {
            content: "\f077";
        }
        .toggle-all {
            margin-bottom: 20px;
            padding: 10px 20px;
            background-color: #3B82F6; /* Corrigé la couleur */
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: background-color 0.3s ease;
        }
        .toggle-all:hover {
            background-color: #2563EB;
        }
        .date-picker-container {
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        .flatpickr-input {
            background-color: #E5E7EB;
            border: none;
            border-radius: 8px;
            padding: 10px;
            width: 150px;
            color: #1F2A44;
            font-family: 'Inter', sans-serif;
        }
        .flatpickr-input:focus {
            outline: none;
            background-color: #D1D5DB;
        }
        .date-picker-label {
            font-weight: 600;
            color: #1F2A44;
        }
        /* Ajouté pour éviter les superpositions */
        .row {
            display: flex;
            flex-wrap: wrap;
            margin-right: -15px;
            margin-left: -15px;
        }
        .col-lg-4, .col-lg-6, .col-md-12 {
            padding-right: 15px;
            padding-left: 15px;
        }
        /* Correction des icônes de KPI */
        .kpi-card .icon.bg-blue {
            background-color: #3B82F6;
        }
        .kpi-card .icon.bg-green {
            background-color: #10B981;
        }
        .kpi-card .icon.bg-yellow {
            background-color: #F59E0B;
        }

        /* Nouveaux styles pour l'interface améliorée */
        .icon-circle {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.10);
        }
        
        .bg-gradient-primary {
            background: linear-gradient(45deg, #3B82F6, #60A5FA);
        }
        
        .bg-gradient-success {
            background: linear-gradient(45deg, #10B981, #34D399);
        }
        
        .bg-gradient-warning {
            background: linear-gradient(45deg, #F59E0B, #FBBF24);
        }
        
        .bg-gradient-info {
            background: linear-gradient(45deg, #06B6D4, #22D3EE);
        }
        
        .bg-gradient-danger {
            background: linear-gradient(45deg, #EF4444, #F87171);
        }

        /* Styles pour les tableaux */
        .table th {
            font-size: 0.65rem;
            letter-spacing: 0.5px;
            padding-top: 0.75rem;
            padding-bottom: 0.75rem;
            font-weight: 700;
        }
        
        .table td {
            padding: 1rem 0.75rem;
            vertical-align: middle;
            color: #1F2A44;
            border-bottom: 1px solid rgba(229, 231, 235, 0.7);
        }
        
        /* Styles pour les onglets */
        .nav-pills .nav-link {
            color: #6B7280;
            font-weight: 500;
            padding: 10px 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .nav-pills .nav-link.active {
            background-color: #3B82F6;
            color: white;
            box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3);
        }
        
        .tab-content {
            padding-top: 20px;
        }
        
        /* Boutons et badges */
        .btn-sm {
            padding: 0.4rem 0.8rem;
            font-size: 0.75rem;
            border-radius: 6px;
        }
        
        .form-select-sm {
            padding: 0.25rem 2rem 0.25rem 0.75rem;
            font-size: 0.75rem;
            border-radius: 6px;
        }
        
        /* Progress bar */
        .progress {
            overflow: hidden;
            height: 8px;
            border-radius: 8px;
        }
        
        /* Cards style */
        .card {
            transition: all 0.3s ease-in-out;
            border-radius: 12px;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1) !important;
        }
        
        .card-header {
            padding: 1.25rem;
            background-color: transparent;
            border-bottom: 0;
        }
        
        .card-header h6 {
            margin: 0;
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        /* Funnel visualization */
        .reservation-funnel {
            padding: 1rem 0;
        }
        
        .funnel-step {
            margin-bottom: 15px;
        }
        
        .funnel-step-bar {
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 500;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: width 1s ease-in-out;
        }
        
        /* Badges et couleurs */
        .badge {
            padding: 0.5em 0.75em;
            font-weight: 500;
            font-size: 0.75rem;
            border-radius: 6px;
        }
        
        .text-primary { color: #3B82F6 !important; }
        .text-success { color: #10B981 !important; }
        .text-info { color: #06B6D4 !important; }
        .text-warning { color: #F59E0B !important; }
        .text-danger { color: #EF4444 !important; }
        
        .bg-primary { background-color: #3B82F6 !important; }
        .bg-success { background-color: #10B981 !important; }
        .bg-info { background-color: #06B6D4 !important; }
        .bg-warning { background-color: #F59E0B !important; }
        .bg-danger { background-color: #EF4444 !important; }
    </style>
{% endblock %}

{% block body %}
   <aside class="sidenav navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-3 bg-light" id="sidenav-main">
    <div class="sidenav-header">
        <a class="navbar-brand m-0" href="{{ path('admin_dashboard') }}">
            <img src="{{ asset('assets/img/EVENTORA.png') }}" class="navbar-brand-img" style="max-height: 40px;" alt="main_logo">
        </a>
    </div>
    <hr class="horizontal dark mt-0">
    <div class="collapse navbar-collapse w-auto" id="sidenav-collapse-main">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link {{ app.request.attributes.get('_route') == 'admin_dashboard' ? 'active' : '' }}" href="{{ path('admin_dashboard') }}">
                    <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="fas fa-tachometer-alt text-dark"></i>
                    </div>
                    <span class="nav-link-text ms-1">Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link {{ app.request.attributes.get('_route') == 'app_home_page' ? 'active' : '' }}" href="{{ path('app_home_page') }}">
                    <div class="icon icon-home icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="fas fa-tachometer-alt text-dark"></i>
                    </div>
                    <span class="nav-link-text ms-1">Home</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link dropdown-toggle {{ app.request.attributes.get('_route') starts with 'admin_reservations' ? 'active' : '' }}" href="#" data-bs-toggle="collapse" data-bs-target="#reservationsMenu" aria-expanded="{{ app.request.attributes.get('_route') starts with 'admin_reservations' ? 'true' : 'false' }}">
                    <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="fas fa-calendar-check text-dark"></i>
                    </div>
                    <span class="nav-link-text ms-1">Reservations</span>
                </a>
                <div class="collapse {{ app.request.attributes.get('_route') starts with 'admin_reservations' ? 'show' : '' }}" id="reservationsMenu">
                    <ul class="navbar-nav ms-3">
                        <li class="nav-item">
                            <a class="nav-link {{ app.request.attributes.get('_route') == 'admin_reservations_pack' ? 'active' : '' }}" href="{{ path('admin_reservations_pack') }}">
                                <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                                    <i class="fas fa-box text-dark"></i>
                                </div>
                                <span class="nav-link-text ms-1">Pack Reservations</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {{ app.request.attributes.get('_route') == 'admin_reservations_personnalise' ? 'active' : '' }}" href="{{ path('admin_reservations_personnalise') }}">
                                <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                                    <i class="fas fa-calendar-alt text-dark"></i>
                                </div>
                                <span class="nav-link-text ms-1">Personalized Reservations</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link dropdown-toggle {{ app.request.attributes.get('_route') starts with 'admin_reclamations' or app.request.attributes.get('_route') starts with 'admin_feedback' ? 'active' : '' }}" href="#" data-bs-toggle="collapse" data-bs-target="#complaintsMenu" aria-expanded="{{ app.request.attributes.get('_route') starts with 'admin_reclamations' or app.request.attributes.get('_route') starts with 'admin_feedback' ? 'true' : 'false' }}">
                    <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="fas fa-exclamation-triangle text-dark"></i>
                    </div>
                    <span class="nav-link-text ms-1">Complaints</span>
                </a>
                <div class="collapse {{ app.request.attributes.get('_route') starts with 'admin_reclamations' or app.request.attributes.get('_route') starts with 'admin_feedback' ? 'show' : '' }}" id="complaintsMenu">
                    <ul class="navbar-nav ms-3">
                        <li class="nav-item">
                            <a class="nav-link {{ app.request.attributes.get('_route') starts with 'admin_reclamations' ? 'active' : '' }}" href="{{ path('admin_reclamations') }}">
                                <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                                    <i class="fas fa-exclamation-circle text-dark"></i>
                                </div>
                                <span class="nav-link-text ms-1">Complaints</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {{ app.request.attributes.get('_route') starts with 'admin_feedback' ? 'active' : '' }}" href="{{ path('admin_feedback') }}">
                                <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                                    <i class="fas fa-comment-dots text-dark"></i>
                                </div>
                                <span class="nav-link-text ms-1">Feedback</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link dropdown-toggle {{ app.request.attributes.get('_route') starts with 'admin_membres' or app.request.attributes.get('_route') starts with 'admin_moderators' or app.request.attributes.get('_route') starts with 'admin_admins' ? 'active' : '' }}" href="#" data-bs-toggle="collapse" data-bs-target="#usersMenu" aria-expanded="{{ app.request.attributes.get('_route') starts with 'admin_membres' or app.request.attributes.get('_route') starts with 'admin_moderators' or app.request.attributes.get('_route') starts with 'admin_admins' ? 'true' : 'false' }}">
                    <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="fas fa-users text-dark"></i>
                    </div>
                    <span class="nav-link-text ms-1">Users</span>
                </a>
                <div class="collapse {{ app.request.attributes.get('_route') starts with 'admin_membres' or app.request.attributes.get('_route') starts with 'admin_moderators' or app.request.attributes.get('_route') starts with 'admin_admins' ? 'show' : '' }}" id="usersMenu">
                    <ul class="navbar-nav ms-3">
                        <li class="nav-item">
                            <a class="nav-link {{ app.request.attributes.get('_route') starts with 'admin_membres' ? 'active' : '' }}" href="{{ path('admin_membres') }}">
                                <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                                    <i class="fas fa-user-friends text-dark"></i>
                                </div>
                                <span class="nav-link-text ms-1">Members</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {{ app.request.attributes.get('_route') starts with 'app_agent_index' ? 'active' : '' }}" href="{{ path('app_agent_index') }}">
                                <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                                    <i class="fas fa-user-shield text-dark"></i>
                                </div>
                                <span class="nav-link-text ms-1">Agents</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link dropdown-toggle {{ app.request.attributes.get('_route') in ['admin_packs', 'admin_typepacks'] ? 'active' : '' }}" href="#" data-bs-toggle="collapse" data-bs-target="#packsMenu" aria-expanded="{{ app.request.attributes.get('_route') in ['admin_packs', 'admin_typepacks'] ? 'true' : 'false' }}">
                    <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="fas fa-box text-dark"></i>
                    </div>
                    <span class="nav-link-text ms-1">Packs</span>
                </a>
                <div class="collapse {{ app.request.attributes.get('_route') in ['admin_packs', 'admin_typepacks'] ? 'show' : '' }}" id="packsMenu">
                    <ul class="navbar-nav ms-3">
                        <li class="nav-item">
                            <a class="nav-link {{ app.request.attributes.get('_route') == 'admin_packs' ? 'active' : '' }}" href="{{ path('admin_packs') }}">
                                <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                                    <i class="fas fa-box-open text-dark"></i>
                                </div>
                                <span class="nav-link-text ms-1">Packs</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {{ app.request.attributes.get('_route') == 'admin_typepacks' ? 'active' : '' }}" href="{{ path('admin_typepacks') }}">
                                <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                                    <i class="fas fa-tags text-dark"></i>
                                </div>
                                <span class="nav-link-text ms-1">Pack Types</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link dropdown-toggle {{ app.request.attributes.get('_route') starts with 'admin_services' or app.request.attributes.get('_route') starts with 'admin_sponsors' ? 'active' : '' }}" href="#" data-bs-toggle="collapse" data-bs-target="#servicesMenu" aria-expanded="{{ app.request.attributes.get('_route') starts with 'admin_services' or app.request.attributes.get('_route') starts with 'admin_sponsors' ? 'true' : 'false' }}">
                    <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="fas fa-concierge-bell text-dark"></i>
                    </div>
                    <span class="nav-link-text ms-1">Services</span>
                </a>
                <div class="collapse {{ app.request.attributes.get('_route') starts with 'admin_services' or app.request.attributes.get('_route') starts with 'admin_sponsors' ? 'show' : '' }}" id="servicesMenu">
                    <ul class="navbar-nav ms-3">
                        <li class="nav-item">
                            <a class="nav-link {{ app.request.attributes.get('_route') starts with 'admin_services' ? 'active' : '' }}" href="{{ path('admin_services') }}">
                                <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                                    <i class="fas fa-tools text-dark"></i>
                                </div>
                                <span class="nav-link-text ms-1">Services</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {{ app.request.attributes.get('_route') starts with 'admin_sponsors' ? 'active' : '' }}" href="{{ path('admin_sponsors') }}">
                                <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                                    <i class="fas fa-handshake text-dark"></i>
                                </div>
                                <span class="nav-link-text ms-1">Partners</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="{{ path('app_logout') }}">
                    <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="fas fa-sign-out-alt text-dark"></i>
                    </div>
                    <span class="nav-link-text ms-1">Log out</span>
                </a>
            </li>
        </ul>
    </div>
</aside>

    <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg">
        {% block content %}
            <nav class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl" id="navbarBlur">
                <div class="container-fluid py-1 px-3">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0 me-sm-6 me-5">
                            <li class="breadcrumb-item text-sm"><a class="opacity-5 text-dark" href="#">Pages</a></li>
                            <li class="breadcrumb-item text-sm text-dark active" aria-current="page">Dashboard</li>
                        </ol>
                        <h6 class="font-weight-bolder mb-0">Dashboard</h6>
                    </nav>
                    <div class="collapse navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4" id="navbar">
                        <div class="ms-md-auto pe-md-3 d-flex align-items-center">
                            <div class="input-group">
                                <span class="input-group-text text-body"><i class="fas fa-search" aria-hidden="true"></i></span>
                                <input type="text" class="form-control" placeholder="Rechercher...">
                            </div>
                        </div>
                        <ul class="navbar-nav justify-content-end">
                            <li class="nav-item d-flex align-items-center">
                                <a href="#" class="nav-link text-body font-weight-bold px-0">
                                    <i class="fa fa-user me-sm-1"></i>
                                    <span class="d-sm-inline d-none">{{ app.user.email ?? 'Utilisateur' }}</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>

            <div class="container-fluid py-4">
                <button class="toggle-all btn btn-primary mb-3" id="toggleAllButton" onclick="toggleAllSections()">Tout réduire</button>

                <div class="collapsible-section">
                    <div class="collapsible-header" onclick="toggleSection(this)">
                        <h4>Réclamations</h4>
                        <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
                    </div>
                    <div class="collapsible-content module-section">
                        <div class="date-picker-container">
                            <div>
                                <label for="startDate" class="date-picker-label">Date de début:</label>
                                <input type="text" id="startDate" class="flatpickr-input" value="{{ start_date }}" readonly="readonly">
                            </div>
                            <div>
                                <label for="endDate" class="date-picker-label">Date de fin:</label>
                                <input type="text" id="endDate" class="flatpickr-input" value="{{ end_date }}" readonly="readonly">
                            </div>
                        </div>

                        <div class="row mb-5">
                            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 mb-4">
                                <div class="card kpi-card">
                                    <div class="card-body p-3 position-relative">
                                        <div class="row align-items-center">
                                            <div class="col-8 text-start">
                                                <div class="icon icon-shape shadow text-center border-radius-2xl bg-blue">
                                                    <i class="fas fa-exclamation-circle text-white text-lg opacity-10"></i>
                                                </div>
                                                <h5 class="font-weight-bolder mb-0 mt-3">{{ total_reclamations }}</h5>
                                                <span class="text-sm">Total Réclamations</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 mb-4">
                                <div class="card kpi-card">
                                    <div class="card-body p-3 position-relative">
                                        <div class="row align-items-center">
                                            <div class="col-8 text-start">
                                                <div class="icon icon-shape shadow text-center border-radius-2xl bg-blue">
                                                    <i class="fas fa-exclamation-circle text-white text-lg opacity-10"></i>
                                                </div>
                                                <h5 class="font-weight-bolder mb-0 mt-3">{{ total_reclamations_selected }}</h5>
                                                <span class="text-sm">Réclamations (Période)</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 mb-4">
                                <div class="card kpi-card">
                                    <div class="card-body p-3 position-relative">
                                        <div class="row align-items-center">
                                            <div class="col-8 text-start">
                                                <div class="icon icon-shape shadow text-center border-radius-2xl bg-green">
                                                    <i class="fas fa-check-circle text-white text-lg opacity-10"></i>
                                                </div>
                                                <h5 class="font-weight-bolder mb-0 mt-3">{{ pourcentage_traitees|round(2) }}%</h5>
                                                <span class="text-sm">Réclamations Traitées</span>
                                            </div>
                                            <div class="col-4 text-end">
                                                <p class="trend positive mb-0">+5%</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 mb-4">
                                <div class="card kpi-card">
                                    <div class="card-body p-3 position-relative">
                                        <div class="row align-items-center">
                                            <div class="col-8 text-start">
                                                <div class="icon icon-shape shadow text-center border-radius-2xl bg-yellow">
                                                    <i class="fas fa-hourglass-half text-white text-lg opacity-10"></i>
                                                </div>
                                                <h5 class="font-weight-bolder mb-0 mt-3">{{ pourcentage_non_traitees|round(2) }}%</h5>
                                                <span class="text-sm">Réclamations Non Traitées</span>
                                            </div>
                                            <div class="col-4 text-end">
                                                <p class="trend negative mb-0">-2%</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6 col-md-12 mb-4">
                                <div class="card chart-card">
                                    <div class="card-header">
                                        <h6>Réclamations par Jour</h6>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="reclamations-by-date-chart" class="chart-canvas"></canvas>
                                        <div id="no-date-data-message" class="text-center text-muted mt-3" style="display: none;">
                                            Aucune donnée disponible pour les réclamations par date.
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-12 mb-4">
                                <div class="card chart-card">
                                    <div class="card-header">
                                        <h6>Réclamations Traitées vs Non Traitées</h6>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="reclamations-treated-vs-untreated-chart" class="chart-canvas"></canvas>
                                        <div id="no-treated-data-message" class="text-center text-muted mt-3" style="display: none;">
                                            Aucune donnée disponible pour les réclamations traitées/non traitées.
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-12 mb-4">
                                <div class="card chart-card">
                                    <div class="card-header">
                                        <h6>Réclamations par Type</h6>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="reclamations-by-type-chart" class="chart-canvas"></canvas>
                                        <div id="no-type-data-message" class="text-center text-muted mt-3" style="display: none;">
                                            Aucune donnée disponible pour les réclamations par type.
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-12 mb-4">
                                <div class="card chart-card">
                                    <div class="card-header">
                                        <h6>Réclamations par Statut</h6>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="reclamations-status-distribution-chart" class="chart-canvas"></canvas>
                                        <div id="no-status-data-message" class="text-center text-muted mt-3" style="display: none;">
                                            Aucune donnée disponible pour les réclamations par statut.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="collapsible-section">
                    <div class="collapsible-header" onclick="toggleSection(this)">
                        <h4><i class="fas fa-star me-2 text-warning"></i>Feedbacks</h4>
                        <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
                    </div>
                    <div class="collapsible-content module-section">
                        <!-- Barre de navigation supplémentaire pour les statistiques de feedback -->
                        <div class="feedback-stats-nav mb-4">
                            <ul class="nav nav-pills nav-fill bg-white p-2 rounded shadow-sm">
                                <li class="nav-item">
                                    <a class="nav-link active" data-bs-toggle="tab" href="#feedback-overview">
                                        <i class="fas fa-chart-pie me-2"></i>Vue d'ensemble
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#feedback-sentiment">
                                        <i class="fas fa-smile me-2"></i>Analyse du sentiment
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#feedback-engagement">
                                        <i class="fas fa-users me-2"></i>Engagement
                                    </a>
                                </li>
                            </ul>
                        </div>

                        <div class="tab-content">
                            <!-- Tab 1: Vue d'ensemble -->
                            <div class="tab-pane fade show active" id="feedback-overview">
                        <div class="row mb-5">
                                    <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 mb-4">
                                        <div class="card border-0 shadow-sm h-100">
                                    <div class="card-body p-3 position-relative">
                                                <div class="position-absolute top-0 end-0 mt-3 me-3">
                                                    <div class="icon-circle bg-gradient-warning">
                                                    <i class="fas fa-star text-white text-lg opacity-10"></i>
                                                </div>
                                            </div>
                                                <div class="text-start mt-2">
                                                    <p class="text-sm mb-0 text-capitalize text-muted">Score Moyen</p>
                                                    <h4 class="font-weight-bolder mb-0 mt-2">{{ avg_vote|round(2) }}/5</h4>
                                                    <div class="d-flex align-items-center mt-3">
                                                        {% if avg_vote_trend > 0 %}
                                                            <span class="badge bg-success me-2">
                                                                <i class="fas fa-arrow-up me-1"></i>{{ avg_vote_trend|round(2) }}%
                                                            </span>
                                                            <p class="text-sm mb-0">vs période précédente</p>
                                                        {% elseif avg_vote_trend < 0 %}
                                                            <span class="badge bg-danger me-2">
                                                                <i class="fas fa-arrow-down me-1"></i>{{ (avg_vote_trend * -1)|round(2) }}%
                                                            </span>
                                                            <p class="text-sm mb-0">vs période précédente</p>
                                                        {% else %}
                                                            <span class="badge bg-secondary me-2">
                                                                <i class="fas fa-equals me-1"></i>0%
                                                            </span>
                                                            <p class="text-sm mb-0">stable</p>
                                                        {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                            <div class="card-footer p-3 bg-transparent border-top">
                                                <div class="d-flex">
                                                    {% for i in 1..5 %}
                                                        <div class="text-center flex-grow-1">
                                                            <i class="fas fa-star text-warning"></i>
                                                            <p class="text-xs mb-0 font-weight-bold">{{ (feedbacks_by_vote|filter(f => f.vote == i)|first).count|default(0) }}</p>
                                </div>
                                                    {% endfor %}
                            </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 mb-4">
                                        <div class="card border-0 shadow-sm h-100">
                                    <div class="card-body p-3 position-relative">
                                                <div class="position-absolute top-0 end-0 mt-3 me-3">
                                                    <div class="icon-circle bg-gradient-info">
                                                    <i class="fas fa-thumbs-up text-white text-lg opacity-10"></i>
                                                </div>
                                            </div>
                                                <div class="text-start mt-2">
                                                    <p class="text-sm mb-0 text-capitalize text-muted">NPS Score</p>
                                                    <h4 class="font-weight-bolder mb-0 mt-2">{{ nps_score|round(0) }}</h4>
                                                    <div class="d-flex align-items-center mt-3">
                                                        <p class="text-sm mb-0">
                                                            <span class="font-weight-bold me-1">
                                                                {% if nps_score >= 50 %}
                                                                    <span class="text-success">Excellent</span>
                                                                {% elseif nps_score >= 30 %}
                                                                    <span class="text-info">Bon</span>
                                                                {% elseif nps_score >= 0 %}
                                                                    <span class="text-warning">Moyen</span>
                                                                {% else %}
                                                                    <span class="text-danger">Critique</span>
                                                                {% endif %}
                                                            </span>
                                                        </p>
                                        </div>
                                    </div>
                                </div>
                                            <div class="card-footer p-3 bg-transparent border-top">
                                                <div class="progress-wrapper">
                                                    <div class="progress-info">
                                                        <div class="progress-percentage">
                                                            <span class="text-xs font-weight-bold">Score NPS</span>
                            </div>
                                                    </div>
                                                    <div class="progress" style="height: 8px;">
                                                        <div class="progress-bar bg-gradient-{{ nps_score >= 50 ? 'success' : (nps_score >= 30 ? 'info' : (nps_score >= 0 ? 'warning' : 'danger')) }}" style="width: {{ ((nps_score + 100) / 2)|round }}%;"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 mb-4">
                                        <div class="card border-0 shadow-sm h-100">
                                    <div class="card-body p-3 position-relative">
                                                <div class="position-absolute top-0 end-0 mt-3 me-3">
                                                    <div class="icon-circle bg-gradient-success">
                                                    <i class="fas fa-image text-white text-lg opacity-10"></i>
                                                </div>
                                            </div>
                                                <div class="text-start mt-2">
                                                    <p class="text-sm mb-0 text-capitalize text-muted">Avec Image</p>
                                                    <h4 class="font-weight-bolder mb-0 mt-2">{{ image_feedback_rate|round(1) }}%</h4>
                                                    <div class="d-flex align-items-center mt-3">
                                                        <p class="text-sm mb-0">des feedbacks incluent des souvenirs visuels</p>
                                        </div>
                                    </div>
                                </div>
                                            <div class="card-footer p-3 bg-transparent border-top">
                                                <div class="progress-wrapper">
                                                    <div class="progress-info">
                                                        <div class="progress-percentage">
                                                            <span class="text-xs font-weight-bold">Taux d'images</span>
                            </div>
                        </div>
                                                    <div class="progress" style="height: 8px;">
                                                        <div class="progress-bar bg-gradient-success" style="width: {{ image_feedback_rate|round }}%;"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 mb-4">
                                        <div class="card border-0 shadow-sm h-100">
                                            <div class="card-body p-3 position-relative">
                                                <div class="position-absolute top-0 end-0 mt-3 me-3">
                                                    <div class="icon-circle bg-gradient-danger">
                                                        <i class="fas fa-comment-dots text-white text-lg opacity-10"></i>
                                                    </div>
                                                </div>
                                                <div class="text-start mt-2">
                                                    <p class="text-sm mb-0 text-capitalize text-muted">Taux de participation</p>
                                                    <h4 class="font-weight-bolder mb-0 mt-2">{{ (user_engagement|length / total_members * 100)|round(1) }}%</h4>
                                                    <div class="d-flex align-items-center mt-3">
                                                        <p class="text-sm mb-0">des membres ont laissé un feedback</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="card-footer p-3 bg-transparent border-top">
                                                <div class="progress-wrapper">
                                                    <div class="progress-info">
                                                        <div class="progress-percentage">
                                                            <span class="text-xs font-weight-bold">Taux de participation</span>
                                                        </div>
                                                    </div>
                                                    <div class="progress" style="height: 8px;">
                                                        <div class="progress-bar bg-gradient-danger" style="width: {{ (user_engagement|length / total_members * 100)|round }}%;"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                        <div class="row">
                                    <div class="col-lg-8 col-md-12 mb-4">
                                        <div class="card border-0 shadow-sm">
                                            <div class="card-header bg-transparent border-0">
                                                <h6 class="mb-0 text-capitalize">Distribution des Notes</h6>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="feedbacks-by-vote-chart" class="chart-canvas"></canvas>
                                        <div id="no-vote-data-message" class="text-center text-muted mt-3" style="display: none;">
                                            Aucune donnée disponible pour les feedbacks par note.
                                        </div>
                                    </div>
                                </div>
                            </div>
                                    <div class="col-lg-4 col-md-12 mb-4">
                                        <div class="card border-0 shadow-sm h-100">
                                            <div class="card-header bg-transparent border-0">
                                                <h6 class="mb-0 text-capitalize">Top Recommandations</h6>
                                            </div>
                                            <div class="card-body p-0">
                                                <div class="table-responsive" style="max-height: 292px; overflow-y: auto;">
                                                    <table class="table align-items-center mb-0">
                                                        <thead>
                                                            <tr>
                                                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Utilisateur</th>
                                                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Feedbacks</th>
                                                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Note moyenne</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {% for user in user_engagement|slice(0, 5) %}
                                                            <tr>
                                                                <td>
                                                                    <div class="d-flex px-3 py-1">
                                                                        <div class="d-flex flex-column justify-content-center">
                                                                            <h6 class="mb-0 text-sm">{{ user.email }}</h6>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                <td>
                                                                    <p class="text-xs font-weight-bold mb-0 px-3">{{ user.feedbackCount }}</p>
                                                                </td>
                                                                <td>
                                                                    <div class="d-flex px-3 py-1 align-items-center">
                                                                        <span class="text-xs font-weight-bold me-2">{{ 4.5|round(1) }}</span>
                                                                        <div class="text-warning">
                                                                            {% for i in 1..5 %}
                                                                                <i class="fas fa-star{{ i <= 4.5 ? '' : '-half-alt' }} text-xs"></i>
                                                                            {% endfor %}
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                            {% else %}
                                                            <tr>
                                                                <td colspan="3" class="text-center py-4">
                                                                    <p class="text-sm text-muted mb-0">Aucune donnée disponible.</p>
                                                                </td>
                                                            </tr>
                                                            {% endfor %}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Tab 2: Analyse du sentiment -->
                            <div class="tab-pane fade" id="feedback-sentiment">
                                <div class="row">
                            <div class="col-lg-6 col-md-12 mb-4">
                                        <div class="card border-0 shadow-sm">
                                            <div class="card-header bg-transparent border-0">
                                                <h6 class="mb-0 text-capitalize">Répartition du Sentiment</h6>
                                    </div>
                                    <div class="card-body">
                                                <canvas id="sentiment-distribution-chart" height="250"></canvas>
                                            </div>
                                            <div class="card-footer bg-transparent border-top p-3">
                                                <div class="row g-3">
                                                    <div class="col-4">
                                                        <div class="d-flex flex-column">
                                                            <span class="text-success font-weight-bolder">Positif</span>
                                                            <span class="font-weight-bold">{{ ((feedbacks_by_vote|filter(f => f.vote >= 4)|reduce((sum, f) => sum + f.count, 0)) / (feedbacks_by_vote|reduce((sum, f) => sum + f.count, 0)) * 100)|round(1) }}%</span>
                                                        </div>
                                                    </div>
                                                    <div class="col-4">
                                                        <div class="d-flex flex-column">
                                                            <span class="text-warning font-weight-bolder">Neutre</span>
                                                            <span class="font-weight-bold">{{ ((feedbacks_by_vote|filter(f => f.vote == 3)|reduce((sum, f) => sum + f.count, 0)) / (feedbacks_by_vote|reduce((sum, f) => sum + f.count, 0)) * 100)|round(1) }}%</span>
                                                        </div>
                                                    </div>
                                                    <div class="col-4">
                                                        <div class="d-flex flex-column">
                                                            <span class="text-danger font-weight-bolder">Négatif</span>
                                                            <span class="font-weight-bold">{{ ((feedbacks_by_vote|filter(f => f.vote <= 2)|reduce((sum, f) => sum + f.count, 0)) / (feedbacks_by_vote|reduce((sum, f) => sum + f.count, 0)) * 100)|round(1) }}%</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12 mb-4">
                                        <div class="card border-0 shadow-sm">
                                            <div class="card-header bg-transparent border-0">
                                                <h6 class="mb-0 text-capitalize">Évolution du Sentiment</h6>
                                            </div>
                                            <div class="card-body">
                                                <canvas id="sentiment-trend-chart" height="250"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-12 mb-4">
                                        <div class="card border-0 shadow-sm">
                                            <div class="card-header bg-transparent border-0">
                                                <h6 class="mb-0 text-capitalize">Points Forts et Points Faibles</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <h6 class="text-success mb-3">Points Forts <i class="fas fa-thumbs-up ms-2"></i></h6>
                                                        <div class="mb-3">
                                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                                <span class="text-sm font-weight-bold">Service client</span>
                                                                <span class="text-sm">87%</span>
                                                            </div>
                                                            <div class="progress" style="height: 8px;">
                                                                <div class="progress-bar bg-gradient-success" style="width: 87%;"></div>
                                                            </div>
                                                        </div>
                                                        <div class="mb-3">
                                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                                <span class="text-sm font-weight-bold">Qualité des packs</span>
                                                                <span class="text-sm">82%</span>
                                                            </div>
                                                            <div class="progress" style="height: 8px;">
                                                                <div class="progress-bar bg-gradient-success" style="width: 82%;"></div>
                                                            </div>
                                                        </div>
                                                        <div class="mb-3">
                                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                                <span class="text-sm font-weight-bold">Facilité d'utilisation</span>
                                                                <span class="text-sm">76%</span>
                                                            </div>
                                                            <div class="progress" style="height: 8px;">
                                                                <div class="progress-bar bg-gradient-success" style="width: 76%;"></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <h6 class="text-danger mb-3">Points à Améliorer <i class="fas fa-tools ms-2"></i></h6>
                                                        <div class="mb-3">
                                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                                <span class="text-sm font-weight-bold">Disponibilité des dates</span>
                                                                <span class="text-sm">32%</span>
                                                            </div>
                                                            <div class="progress" style="height: 8px;">
                                                                <div class="progress-bar bg-gradient-danger" style="width: 32%;"></div>
                                                            </div>
                                                        </div>
                                                        <div class="mb-3">
                                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                                <span class="text-sm font-weight-bold">Options de paiement</span>
                                                                <span class="text-sm">41%</span>
                                                            </div>
                                                            <div class="progress" style="height: 8px;">
                                                                <div class="progress-bar bg-gradient-danger" style="width: 41%;"></div>
                                                            </div>
                                                        </div>
                                                        <div class="mb-3">
                                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                                <span class="text-sm font-weight-bold">Personnalisation</span>
                                                                <span class="text-sm">53%</span>
                                                            </div>
                                                            <div class="progress" style="height: 8px;">
                                                                <div class="progress-bar bg-gradient-warning" style="width: 53%;"></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Tab 3: Engagement -->
                            <div class="tab-pane fade" id="feedback-engagement">
                                <div class="row">
                                    <div class="col-lg-8 col-md-12 mb-4">
                                        <div class="card border-0 shadow-sm">
                                            <div class="card-header bg-transparent border-0">
                                                <h6 class="mb-0 text-capitalize">Utilisateurs les plus actifs</h6>
                                            </div>
                                            <div class="card-body">
                                                <canvas id="user-engagement-chart" height="300"></canvas>
                                        <div id="no-engagement-data-message" class="text-center text-muted mt-3" style="display: none;">
                                            Aucune donnée disponible pour l'engagement.
                                        </div>
                                    </div>
                                </div>
                            </div>
                                    <div class="col-lg-4 col-md-12 mb-4">
                                        <div class="card border-0 shadow-sm h-100">
                                            <div class="card-header bg-transparent border-0">
                                                <h6 class="mb-0 text-capitalize">Statistiques d'Engagement</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="mb-4">
                                                    <p class="text-sm text-muted mb-1">Taux de feedback après réservation</p>
                                                    <div class="d-flex align-items-center">
                                                        <h5 class="font-weight-bolder mb-0 me-2">42%</h5>
                                                        <div class="progress flex-grow-1" style="height: 5px;">
                                                            <div class="progress-bar bg-gradient-primary" role="progressbar" style="width: 42%;" aria-valuenow="42" aria-valuemin="0" aria-valuemax="100"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="mb-4">
                                                    <p class="text-sm text-muted mb-1">Temps moyen avant feedback</p>
                                                    <div class="d-flex align-items-center">
                                                        <h5 class="font-weight-bolder mb-0 me-2">3.2 jours</h5>
                                                        <span class="badge bg-success">
                                                            <i class="fas fa-arrow-down me-1"></i>0.5j
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="mb-4">
                                                    <p class="text-sm text-muted mb-1">Taux de réponse aux sollicitations</p>
                                                    <div class="d-flex align-items-center">
                                                        <h5 class="font-weight-bolder mb-0 me-2">67%</h5>
                                                        <div class="progress flex-grow-1" style="height: 5px;">
                                                            <div class="progress-bar bg-gradient-info" role="progressbar" style="width: 67%;" aria-valuenow="67" aria-valuemin="0" aria-valuemax="100"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div>
                                                    <p class="text-sm text-muted mb-1">Feedbacks avec commentaires</p>
                                                    <div class="d-flex align-items-center">
                                                        <h5 class="font-weight-bolder mb-0 me-2">78%</h5>
                                                        <div class="progress flex-grow-1" style="height: 5px;">
                                                            <div class="progress-bar bg-gradient-success" role="progressbar" style="width: 78%;" aria-valuenow="78" aria-valuemin="0" aria-valuemax="100"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                        </div>
                    </div>
                </div>

                                <div class="row">
                                    <div class="col-12 mb-4">
                                        <div class="card border-0 shadow-sm">
                                            <div class="card-header bg-transparent border-0">
                                                <h6 class="mb-0 text-capitalize">Cycle de Vie des Feedbacks</h6>
                                            </div>
                                            <div class="card-body p-4">
                                                <div class="feedback-lifecycle">
                                                    <div class="row g-0">
                                                        <div class="col">
                                                            <div class="lifecycle-step active">
                                                                <div class="step-icon">
                                                                    <i class="fas fa-calendar-check"></i>
                                                                </div>
                                                                <div class="step-content">
                                                                    <h6 class="mb-1">Réservation</h6>
                                                                    <p class="text-xs text-muted mb-0">100%</p>
                                                                </div>
                                                                <div class="step-progress">
                                                                    <div class="progress" style="height: 3px;">
                                                                        <div class="progress-bar bg-info" style="width: 100%;"></div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col">
                                                            <div class="lifecycle-step active">
                                                                <div class="step-icon">
                                                                    <i class="fas fa-envelope-open"></i>
                                                                </div>
                                                                <div class="step-content">
                                                                    <h6 class="mb-1">Sollicitation</h6>
                                                                    <p class="text-xs text-muted mb-0">85%</p>
                                                                </div>
                                                                <div class="step-progress">
                                                                    <div class="progress" style="height: 3px;">
                                                                        <div class="progress-bar bg-info" style="width: 85%;"></div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col">
                                                            <div class="lifecycle-step active">
                                                                <div class="step-icon">
                                                                    <i class="fas fa-star"></i>
                                                                </div>
                                                                <div class="step-content">
                                                                    <h6 class="mb-1">Notation</h6>
                                                                    <p class="text-xs text-muted mb-0">67%</p>
                                                                </div>
                                                                <div class="step-progress">
                                                                    <div class="progress" style="height: 3px;">
                                                                        <div class="progress-bar bg-info" style="width: 67%;"></div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col">
                                                            <div class="lifecycle-step active">
                                                                <div class="step-icon">
                                                                    <i class="fas fa-comment-alt"></i>
                                                                </div>
                                                                <div class="step-content">
                                                                    <h6 class="mb-1">Commentaire</h6>
                                                                    <p class="text-xs text-muted mb-0">52%</p>
                                                                </div>
                                                                <div class="step-progress">
                                                                    <div class="progress" style="height: 3px;">
                                                                        <div class="progress-bar bg-info" style="width: 52%;"></div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col">
                                                            <div class="lifecycle-step active">
                                                                <div class="step-icon">
                                                                    <i class="fas fa-image"></i>
                                                                </div>
                                                                <div class="step-content">
                                                                    <h6 class="mb-1">Image</h6>
                                                                    <p class="text-xs text-muted mb-0">{{ image_feedback_rate|round }}%</p>
                                                                </div>
                                                                <div class="step-progress">
                                                                    <div class="progress" style="height: 3px;">
                                                                        <div class="progress-bar bg-info" style="width: {{ image_feedback_rate|round }}%;"></div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section Réservations -->
                <div class="collapsible-section">
                    <div class="collapsible-header" onclick="toggleSection(this)">
                        <h4><i class="fas fa-calendar-check me-2 text-primary"></i>Réservations</h4>
                        <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
                    </div>
                    <div class="collapsible-content module-section">
                        <!-- Barre de navigation supplémentaire pour les statistiques de réservations -->
                        <div class="reservation-stats-nav mb-4">
                            <ul class="nav nav-pills nav-fill bg-white p-2 rounded shadow-sm">
                                <li class="nav-item">
                                    <a class="nav-link active" data-bs-toggle="tab" href="#reservations-overview">
                                        <i class="fas fa-chart-pie me-2"></i>Aperçu
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#reservations-status">
                                        <i class="fas fa-tasks me-2"></i>Statuts
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#reservations-performance">
                                        <i class="fas fa-chart-line me-2"></i>Performance
                                    </a>
                                </li>
                            </ul>
                        </div>

                        <div class="tab-content">
                            <!-- Tab 1: Aperçu global -->
                            <div class="tab-pane fade show active" id="reservations-overview">
                                <div class="row mb-4">
                                    <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 mb-4">
                                        <div class="card border-0 shadow-sm h-100">
                                    <div class="card-body p-3 position-relative">
                                                <div class="position-absolute top-0 end-0 mt-3 me-3">
                                                    <div class="icon-circle bg-gradient-primary">
                                                        <i class="fas fa-calendar-alt text-white text-lg opacity-10"></i>
                                                    </div>
                                                </div>
                                                <div class="text-start mt-2">
                                                    <p class="text-sm mb-0 text-capitalize text-muted">Total Réservations</p>
                                                    <h4 class="font-weight-bolder mb-0 mt-2">{{ total_reservations }}</h4>
                                                    <div class="d-flex align-items-center mt-3">
                                                        <span class="badge bg-success me-2">
                                                            <i class="fas fa-arrow-up me-1"></i>5%
                                                        </span>
                                                        <p class="text-sm mb-0">vs mois précédent</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 mb-4">
                                        <div class="card border-0 shadow-sm h-100">
                                            <div class="card-body p-3 position-relative">
                                                <div class="position-absolute top-0 end-0 mt-3 me-3">
                                                    <div class="icon-circle bg-gradient-success">
                                                    <i class="fas fa-calendar-check text-white text-lg opacity-10"></i>
                                                </div>
                                            </div>
                                                <div class="text-start mt-2">
                                                    <p class="text-sm mb-0 text-capitalize text-muted">Taux d'Acceptation</p>
                                                    <h4 class="font-weight-bolder mb-0 mt-2">{{ (100 - refusal_rate)|round(1) }}%</h4>
                                                    <div class="d-flex align-items-center mt-3">
                                                        <span class="badge bg-success me-2">
                                                            <i class="fas fa-arrow-up me-1"></i>2%
                                                        </span>
                                                        <p class="text-sm mb-0">vs mois précédent</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                                    </div>
                                    <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 mb-4">
                                        <div class="card border-0 shadow-sm h-100">
                                    <div class="card-body p-3 position-relative">
                                                <div class="position-absolute top-0 end-0 mt-3 me-3">
                                                    <div class="icon-circle bg-gradient-info">
                                                        <i class="fas fa-money-bill-wave text-white text-lg opacity-10"></i>
                                                </div>
                                            </div>
                                                <div class="text-start mt-2">
                                                    <p class="text-sm mb-0 text-capitalize text-muted">Valeur Moyenne</p>
                                                    <h4 class="font-weight-bolder mb-0 mt-2">{{ avg_reservation_value|round(2) }} dt</h4>
                                                    <div class="d-flex align-items-center mt-3">
                                                        <span class="badge bg-success me-2">
                                                            <i class="fas fa-arrow-up me-1"></i>3%
                                                        </span>
                                                        <p class="text-sm mb-0">vs mois précédent</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                                    </div>
                                    <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 mb-4">
                                        <div class="card border-0 shadow-sm h-100">
                                    <div class="card-body p-3 position-relative">
                                                <div class="position-absolute top-0 end-0 mt-3 me-3">
                                                    <div class="icon-circle bg-gradient-warning">
                                                        <i class="fas fa-percentage text-white text-lg opacity-10"></i>
                                                </div>
                                            </div>
                                                <div class="text-start mt-2">
                                                    <p class="text-sm mb-0 text-capitalize text-muted">Taux de Conversion</p>
                                                    <h4 class="font-weight-bolder mb-0 mt-2">62.8%</h4>
                                                    <div class="d-flex align-items-center mt-3">
                                                        <span class="badge bg-danger me-2">
                                                            <i class="fas fa-arrow-down me-1"></i>1.5%
                                                        </span>
                                                        <p class="text-sm mb-0">vs mois précédent</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                                </div>

                        <div class="row">
                                    <div class="col-lg-8 col-md-12 mb-4">
                                        <div class="card border-0 shadow-sm">
                                            <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center">
                                                <h6 class="mb-0 text-capitalize">Réservations Récentes</h6>
                                                <a href="{{ path('admin_reservations_pack') }}" class="btn btn-sm btn-primary">Voir Tout</a>
                                            </div>
                                            <div class="card-body p-0">
                                                <div class="table-responsive" style="max-height: 350px; overflow-y: auto;">
                                                    <table class="table align-items-center mb-0">
                                                        <thead>
                                                            <tr>
                                                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Client</th>
                                                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Type</th>
                                                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Date</th>
                                                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Prix</th>
                                                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Statut</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <!-- Données factices - à remplacer par des données réelles -->
                                                            <tr>
                                                                <td>
                                                                    <div class="d-flex px-2 py-1">
                                                                        <div class="d-flex flex-column justify-content-center">
                                                                            <h6 class="mb-0 text-sm">Ahmed Salah</h6>
                                                                            <p class="text-xs text-secondary mb-0">ahmed@example.com</p>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                <td>
                                                                    <span class="badge bg-info">Pack</span>
                                                                </td>
                                                                <td>
                                                                    <p class="text-xs text-secondary mb-0">12/05/2023</p>
                                                                </td>
                                                                <td>
                                                                    <p class="text-xs font-weight-bold mb-0">350 dt</p>
                                                                </td>
                                                                <td>
                                                                    <span class="badge bg-success">Confirmé</span>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <div class="d-flex px-2 py-1">
                                                                        <div class="d-flex flex-column justify-content-center">
                                                                            <h6 class="mb-0 text-sm">Fatima Ben Ali</h6>
                                                                            <p class="text-xs text-secondary mb-0">fatima@example.com</p>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                <td>
                                                                    <span class="badge bg-success">Personnalisé</span>
                                                                </td>
                                                                <td>
                                                                    <p class="text-xs text-secondary mb-0">14/05/2023</p>
                                                                </td>
                                                                <td>
                                                                    <p class="text-xs font-weight-bold mb-0">520 dt</p>
                                                                </td>
                                                                <td>
                                                                    <span class="badge bg-warning">En attente</span>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <div class="d-flex px-2 py-1">
                                                                        <div class="d-flex flex-column justify-content-center">
                                                                            <h6 class="mb-0 text-sm">Mohamed Karim</h6>
                                                                            <p class="text-xs text-secondary mb-0">mohamed@example.com</p>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                <td>
                                                                    <span class="badge bg-info">Pack</span>
                                                                </td>
                                                                <td>
                                                                    <p class="text-xs text-secondary mb-0">15/05/2023</p>
                                                                </td>
                                                                <td>
                                                                    <p class="text-xs font-weight-bold mb-0">420 dt</p>
                                                                </td>
                                                                <td>
                                                                    <span class="badge bg-success">Confirmé</span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-4 col-md-12 mb-4">
                                        <div class="card border-0 shadow-sm h-100">
                                            <div class="card-header bg-transparent border-0">
                                                <h6 class="mb-0 text-capitalize">Répartition par Type</h6>
                                    </div>
                                    <div class="card-body">
                                                <canvas id="reservation-type-chart"></canvas>
                                        </div>
                                            <div class="card-footer bg-transparent border-0 p-3">
                                                <div class="row g-3">
                                                    {% for type in reservations_by_type %}
                                                    <div class="col-6">
                                                        <div class="p-3 rounded bg-light">
                                                            <h6 class="mb-1 text-{{ type.type == 'Pack' ? 'info' : 'success' }}">{{ type.type }}</h6>
                                                            <div class="d-flex justify-content-between align-items-center">
                                                                <span class="font-weight-bold">{{ type.count }}</span>
                                                                <span class="text-sm text-muted">{{ (type.count / total_reservations * 100)|round(1) }}%</span>
                                    </div>
                                </div>
                            </div>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Tab 2: Statuts des réservations -->
                            <div class="tab-pane fade" id="reservations-status">
                                <div class="row">
                            <div class="col-lg-6 col-md-12 mb-4">
                                        <div class="card border-0 shadow-sm">
                                            <div class="card-header bg-transparent border-0">
                                                <h6 class="mb-0 text-capitalize">Statuts des Réservations</h6>
                                    </div>
                                    <div class="card-body">
                                                <canvas id="reservation-status-chart" height="300"></canvas>
                                        </div>
                                    </div>
                                </div>
                                    <div class="col-lg-6 col-md-12 mb-4">
                                        <div class="card border-0 shadow-sm">
                                            <div class="card-header bg-transparent border-0">
                                                <h6 class="mb-0 text-capitalize">Indicateurs de Performance</h6>
                            </div>
                                            <div class="card-body px-0 pt-0 pb-2">
                                                <div class="table-responsive p-0" style="max-height: 350px; overflow-y: auto;">
                                                    <table class="table align-items-center mb-0">
                                                        <thead>
                                                            <tr>
                                                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Indicateur</th>
                                                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Valeur</th>
                                                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Tendance</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <div class="d-flex px-2 py-1">
                                                                        <div class="d-flex flex-column justify-content-center">
                                                                            <h6 class="mb-0 text-sm">Taux d'acceptation</h6>
                                                                            <p class="text-xs text-secondary mb-0">Réservations acceptées</p>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                <td>
                                                                    <p class="text-xs font-weight-bold mb-0">{{ (100 - refusal_rate)|round(1) }}%</p>
                                                                </td>
                                                                <td>
                                                                    <div class="d-flex align-items-center">
                                                                        <span class="me-2 text-xs font-weight-bold">+2.5%</span>
                                                                        <div>
                                                                            <div class="progress" style="width: 100px;">
                                                                                <div class="progress-bar bg-gradient-success" style="width: 80%"></div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <div class="d-flex px-2 py-1">
                                                                        <div class="d-flex flex-column justify-content-center">
                                                                            <h6 class="mb-0 text-sm">Taux d'annulation</h6>
                                                                            <p class="text-xs text-secondary mb-0">Annulations client</p>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                <td>
                                                                    <p class="text-xs font-weight-bold mb-0">4.2%</p>
                                                                </td>
                                                                <td>
                                                                    <div class="d-flex align-items-center">
                                                                        <span class="me-2 text-xs font-weight-bold">-1.2%</span>
                                                                        <div>
                                                                            <div class="progress" style="width: 100px;">
                                                                                <div class="progress-bar bg-gradient-success" style="width: 90%"></div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <div class="d-flex px-2 py-1">
                                                                        <div class="d-flex flex-column justify-content-center">
                                                                            <h6 class="mb-0 text-sm">Délai de confirmation</h6>
                                                                            <p class="text-xs text-secondary mb-0">Temps moyen</p>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                <td>
                                                                    <p class="text-xs font-weight-bold mb-0">8.5 heures</p>
                                                                </td>
                                                                <td>
                                                                    <div class="d-flex align-items-center">
                                                                        <span class="me-2 text-xs font-weight-bold">-1.5h</span>
                                                                        <div>
                                                                            <div class="progress" style="width: 100px;">
                                                                                <div class="progress-bar bg-gradient-success" style="width: 85%"></div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <div class="d-flex px-2 py-1">
                                                                        <div class="d-flex flex-column justify-content-center">
                                                                            <h6 class="mb-0 text-sm">Taux de conversion</h6>
                                                                            <p class="text-xs text-secondary mb-0">Visite → Réservation</p>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                <td>
                                                                    <p class="text-xs font-weight-bold mb-0">16.8%</p>
                                                                </td>
                                                                <td>
                                                                    <div class="d-flex align-items-center">
                                                                        <span class="me-2 text-xs font-weight-bold text-danger">-0.5%</span>
                                                                        <div>
                                                                            <div class="progress" style="width: 100px;">
                                                                                <div class="progress-bar bg-gradient-warning" style="width: 60%"></div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-12 mb-4">
                                        <div class="card border-0 shadow-sm">
                                            <div class="card-header bg-transparent border-0">
                                                <h6 class="mb-0 text-capitalize">Progression des Statuts</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="reservation-funnel">
                                                    <div class="funnel-step">
                                                        <div class="funnel-step-bar bg-primary" style="width: 100%">
                                                            <span>Créées: 100%</span>
                                                        </div>
                                                    </div>
                                                    <div class="funnel-step">
                                                        <div class="funnel-step-bar bg-info" style="width: 85%">
                                                            <span>En attente: 85%</span>
                                                        </div>
                                                    </div>
                                                    <div class="funnel-step">
                                                        <div class="funnel-step-bar bg-success" style="width: 70%">
                                                            <span>Confirmées: 70%</span>
                                                        </div>
                                                    </div>
                                                    <div class="funnel-step">
                                                        <div class="funnel-step-bar bg-warning" style="width: 60%">
                                                            <span>Payées: 60%</span>
                                                        </div>
                                                    </div>
                                                    <div class="funnel-step">
                                                        <div class="funnel-step-bar bg-danger" style="width: 55%">
                                                            <span>Complétées: 55%</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Tab 3: Performance -->
                            <div class="tab-pane fade" id="reservations-performance">
                                <div class="row">
                                    <div class="col-lg-8 col-md-12 mb-4">
                                        <div class="card border-0 shadow-sm">
                                            <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center">
                                                <h6 class="mb-0 text-capitalize">Tendance des Réservations</h6>
                                                <div>
                                                    <select class="form-select form-select-sm" id="reservation-trend-period">
                                                        <option value="week">Cette semaine</option>
                                                        <option value="month" selected>Ce mois</option>
                                                        <option value="year">Cette année</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="card-body">
                                                <canvas id="reservations-trend-chart" height="300"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-4 col-md-12 mb-4">
                                        <div class="card border-0 shadow-sm h-100">
                                            <div class="card-header bg-transparent border-0">
                                                <h6 class="mb-0 text-capitalize">Valeur Moyenne par Type</h6>
                                            </div>
                                            <div class="card-body">
                                                <canvas id="avg-value-chart" height="250"></canvas>
                                            </div>
                                            <div class="card-footer bg-transparent border-0 p-3">
                                                <div class="text-center">
                                                    <p class="text-sm text-muted mb-0">Valeur moyenne totale: <span class="font-weight-bold">{{ avg_reservation_value|round(2) }} dt</span></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-12 mb-4">
                                        <div class="card border-0 shadow-sm">
                                            <div class="card-header bg-transparent border-0">
                                                <h6 class="mb-0 text-capitalize">Top Packs Réservés</h6>
                                            </div>
                                            <div class="card-body px-0 pt-0 pb-2">
                                                <div class="table-responsive p-0" style="max-height: 350px; overflow-y: auto;">
                                                    <table class="table align-items-center mb-0">
                                                        <thead>
                                                            <tr>
                                                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Pack</th>
                                                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Réservations</th>
                                                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Prix</th>
                                                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Revenus</th>
                                                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Popularité</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {% for pack in popular_packs|slice(0, 5) %}
                                                            <tr>
                                                                <td>
                                                                    <div class="d-flex px-2 py-1">
                                                                        <div class="d-flex flex-column justify-content-center">
                                                                            <h6 class="mb-0 text-sm">{{ pack.nomPack|default('Non défini') }}</h6>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                <td>
                                                                    <p class="text-xs font-weight-bold mb-0">{{ pack.count }}</p>
                                                                </td>
                                                                <td>
                                                                    <p class="text-xs font-weight-bold mb-0">{{ pack.price|default(350) }} dt</p>
                                                                </td>
                                                                <td>
                                                                    <p class="text-xs font-weight-bold mb-0">{{ (pack.count * (pack.price|default(350)))|round(2) }} dt</p>
                                                                </td>
                                                                <td>
                                                                    <div class="d-flex align-items-center">
                                                                        <span class="me-2 text-xs font-weight-bold">{{ ((pack.count / total_reservations) * 100)|round(1) }}%</span>
                                                                        <div>
                                                                            <div class="progress" style="width: 100px;">
                                                                                <div class="progress-bar bg-gradient-info" style="width: {{ ((pack.count / total_reservations) * 100)|round(1) }}%"></div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                            {% else %}
                                                            <tr>
                                                                <td colspan="5" class="text-center">Aucun pack trouvé</td>
                                                            </tr>
                                                            {% endfor %}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section Utilisateurs (Membres) -->
                <div class="collapsible-section">
                    <div class="collapsible-header" onclick="toggleSection(this)">
                        <h4>Utilisateurs</h4>
                        <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
                    </div>
                    <div class="collapsible-content module-section">
                        <div class="row mb-5">
                            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 mb-4">
                                <div class="card kpi-card">
                                    <div class="card-body p-3 position-relative">
                                        <div class="row align-items-center">
                                            <div class="col-8 text-start">
                                                <div class="icon icon-shape shadow text-center border-radius-2xl bg-blue">
                                                    <i class="fas fa-users text-white text-lg opacity-10"></i>
                                                </div>
                                                <h5 class="font-weight-bolder mb-0 mt-3">{{ total_members }}</h5>
                                                <span class="text-sm">Total Membres</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 mb-4">
                                <div class="card kpi-card">
                                    <div class="card-body p-3 position-relative">
                                        <div class="row align-items-center">
                                            <div class="col-8 text-start">
                                                <div class="icon icon-shape shadow text-center border-radius-2xl bg-green">
                                                    <i class="fas fa-user-check text-white text-lg opacity-10"></i>
                                                </div>
                                                <h5 class="font-weight-bolder mb-0 mt-3">{{ active_members }}</h5>
                                                <span class="text-sm">Membres Actifs</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 mb-4">
                                <div class="card kpi-card">
                                    <div class="card-body p-3 position-relative">
                                        <div class="row align-items-center">
                                            <div class="col-8 text-start">
                                                <div class="icon icon-shape shadow text-center border-radius-2xl bg-yellow">
                                                    <i class="fas fa-user-plus text-white text-lg opacity-10"></i>
                                                </div>
                                                <h5 class="font-weight-bolder mb-0 mt-3">{{ recent_registrations }}</h5>
                                                <span class="text-sm">Inscriptions Récentes</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6 col-md-12 mb-4">
                                <div class="card chart-card">
                                    <div class="card-header">
                                        <h6>Répartition par Rôle</h6>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="members-by-role-chart" class="chart-canvas"></canvas>
                                        <div id="no-members-role-data-message" class="text-center text-muted mt-3" style="display: none;">
                                            Aucune donnée disponible pour la répartition par rôle.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section Services (GService) -->
                <div class="collapsible-section">
                    <div class="collapsible-header" onclick="toggleSection(this)">
                        <h4>Services</h4>
                        <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
                    </div>
                    <div class="collapsible-content module-section">
                        <div class="row mb-5">
                            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 mb-4">
                                <div class="card kpi-card">
                                    <div class="card-body p-3 position-relative">
                                        <div class="row align-items-center">
                                            <div class="col-8 text-start">
                                                <div class="icon icon-shape shadow text-center border-radius-2xl bg-blue">
                                                    <i class="fas fa-concierge-bell text-white text-lg opacity-10"></i>
                                                </div>
                                                <h5 class="font-weight-bolder mb-0 mt-3">{{ total_services }}</h5>
                                                <span class="text-sm">Total Services</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 mb-4">
                                <div class="card kpi-card">
                                    <div class="card-body p-3 position-relative">
                                        <div class="row align-items-center">
                                            <div class="col-8 text-start">
                                                <div class="icon icon-shape shadow text-center border-radius-2xl bg-green">
                                                    <i class="fas fa-dollar-sign text-white text-lg opacity-10"></i>
                                                </div>
                                                <h5 class="font-weight-bolder mb-0 mt-3">{{ avg_service_price|round(2) }}</h5>
                                                <span class="text-sm">Prix Moyen</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6 col-md-12 mb-4">
                                <div class="card chart-card">
                                    <div class="card-header">
                                        <h6>Services par Type</h6>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="services-by-type-chart" class="chart-canvas"></canvas>
                                        <div id="no-services-type-data-message" class="text-center text-muted mt-3" style="display: none;">
                                            Aucune donnée disponible pour les services par type.
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-12 mb-4">
                                <div class="card chart-card">
                                    <div class="card-header">
                                        <h6>Top Services Réservés</h6>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="top-services-chart" class="chart-canvas"></canvas>
                                        <div id="no-top-services-data-message" class="text-center text-muted mt-3" style="display: none;">
                                            Aucune donnée disponible pour les services réservés.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section Packs -->
                <div class="collapsible-section">
                    <div class="collapsible-header" onclick="toggleSection(this)">
                        <h4>Packs</h4>
                        <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
                    </div>
                    <div class="collapsible-content module-section">
                        <div class="row mb-5">
                            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 mb-4">
                                <div class="card kpi-card">
                                    <div class="card-body p-3 position-relative">
                                        <div class="row align-items-center">
                                            <div class="col-8 text-start">
                                                <div class="icon icon-shape shadow text-center border-radius-2xl bg-blue">
                                                    <i class="fas fa-box text-white text-lg opacity-10"></i>
                                                </div>
                                                <h5 class="font-weight-bolder mb-0 mt-3">{{ total_packs }}</h5>
                                                <span class="text-sm">Total Packs</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 mb-4">
                                <div class="card kpi-card">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                <!-- Section Paiements -->
                <div class="collapsible-section">
                    <div class="collapsible-header" onclick="toggleSection(this)">
                        <h4><i class="fas fa-money-bill-wave me-2 text-success"></i>Paiements</h4>
                        <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
                        </div>
                    <div class="collapsible-content module-section">
                        <!-- Barre de navigation pour les statistiques de paiement -->
                        <div class="payment-stats-nav mb-4">
                            <ul class="nav nav-pills nav-fill bg-white p-2 rounded shadow-sm">
                                <li class="nav-item">
                                    <a class="nav-link active" data-bs-toggle="tab" href="#payments-overview">
                                        <i class="fas fa-chart-pie me-2"></i>Vue d'ensemble
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#recent-transactions">
                                        <i class="fas fa-list-alt me-2"></i>Transactions récentes
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#payments-trends">
                                        <i class="fas fa-chart-line me-2"></i>Tendances
                                    </a>
                                </li>
                            </ul>
                                    </div>

                        <div class="tab-content">
                            <!-- Tab 1: Vue d'ensemble -->
                            <div class="tab-pane fade show active" id="payments-overview">
                                <div class="row mb-4">
                                    <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 mb-4">
                                        <div class="card border-0 shadow-sm h-100">
                                            <div class="card-body p-3 position-relative">
                                                <div class="position-absolute top-0 end-0 mt-3 me-3">
                                                    <div class="icon-circle bg-gradient-primary">
                                                        <i class="fas fa-exchange-alt text-white text-lg opacity-10"></i>
                                        </div>
                                    </div>
                                                <div class="text-start mt-2">
                                                    <p class="text-sm mb-0 text-capitalize text-muted">Total Transactions</p>
                                                    <h4 class="font-weight-bolder mb-0 mt-2">{{ total_payments }}</h4>
                                                    <div class="d-flex align-items-center mt-3">
                                                        <span class="badge bg-success me-2">
                                                            <i class="fas fa-arrow-up me-1"></i>8%
                                                        </span>
                                                        <p class="text-sm mb-0">vs mois précédent</p>
                                </div>
                            </div>
                                    </div>
                                        </div>
                                    </div>
                                    <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 mb-4">
                                        <div class="card border-0 shadow-sm h-100">
                                            <div class="card-body p-3 position-relative">
                                                <div class="position-absolute top-0 end-0 mt-3 me-3">
                                                    <div class="icon-circle bg-gradient-success">
                                                        <i class="fas fa-money-bill-wave text-white text-lg opacity-10"></i>
                                </div>
                            </div>
                                                <div class="text-start mt-2">
                                                    <p class="text-sm mb-0 text-capitalize text-muted">Montant Total</p>
                                                    <h4 class="font-weight-bolder mb-0 mt-2">{{ total_amount|round(2) }} dt</h4>
                                                    <div class="d-flex align-items-center mt-3">
                                                        <span class="badge bg-success me-2">
                                                            <i class="fas fa-arrow-up me-1"></i>{{ monthly_change_rate > 0 ? monthly_change_rate|round(1) : 3.5 }}%
                                                        </span>
                                                        <p class="text-sm mb-0">vs mois précédent</p>
                        </div>
                    </div>
                </div>
                    </div>
                                    </div>
                            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 mb-4">
                                        <div class="card border-0 shadow-sm h-100">
                                    <div class="card-body p-3 position-relative">
                                                <div class="position-absolute top-0 end-0 mt-3 me-3">
                                                    <div class="icon-circle bg-gradient-info">
                                                        <i class="fas fa-percentage text-white text-lg opacity-10"></i>
                                                </div>
                                                </div>
                                                <div class="text-start mt-2">
                                                    <p class="text-sm mb-0 text-capitalize text-muted">Taux de Conversion</p>
                                                    <h4 class="font-weight-bolder mb-0 mt-2">68.9%</h4>
                                                    <div class="d-flex align-items-center mt-3">
                                                        <span class="badge bg-success me-2">
                                                            <i class="fas fa-arrow-up me-1"></i>1.2%
                                                        </span>
                                                        <p class="text-sm mb-0">vs mois précédent</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 mb-4">
                                        <div class="card border-0 shadow-sm h-100">
                                    <div class="card-body p-3 position-relative">
                                                <div class="position-absolute top-0 end-0 mt-3 me-3">
                                                    <div class="icon-circle bg-gradient-warning">
                                                        <i class="fas fa-shopping-cart text-white text-lg opacity-10"></i>
                                                </div>
                                            </div>
                                                <div class="text-start mt-2">
                                                    <p class="text-sm mb-0 text-capitalize text-muted">Panier Moyen</p>
                                                    <h4 class="font-weight-bolder mb-0 mt-2">{{ (total_amount / total_payments)|round(2) }} dt</h4>
                                                    <div class="d-flex align-items-center mt-3">
                                                        <span class="badge bg-success me-2">
                                                            <i class="fas fa-arrow-up me-1"></i>2.5%
                                                        </span>
                                                        <p class="text-sm mb-0">vs mois précédent</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                                                </div>
                                            </div>

                                <div class="row">
                                    <div class="col-lg-8 col-md-12 mb-4">
                                        <div class="card border-0 shadow-sm">
                                            <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center">
                                                <h6 class="mb-0 text-capitalize">Évolution des Paiements</h6>
                                                <div>
                                                    <select class="form-select form-select-sm" id="payment-chart-period">
                                                        <option value="week">Cette semaine</option>
                                                        <option value="month" selected>Ce mois</option>
                                                        <option value="year">Cette année</option>
                                                    </select>
                                        </div>
                                    </div>
                                            <div class="card-body">
                                                <canvas id="payments-trend-chart" height="300"></canvas>
                                </div>
                            </div>
                                                </div>
                                    <div class="col-lg-4 col-md-12 mb-4">
                                        <div class="card border-0 shadow-sm h-100">
                                            <div class="card-header bg-transparent border-0">
                                                <h6 class="mb-0 text-capitalize">Répartition par Type</h6>
                                            </div>
                                            <div class="card-body">
                                                <canvas id="payments-by-type-chart" height="250"></canvas>
                                                <div id="no-payments-type-data-message" class="text-center text-muted mt-3" style="display: none;">
                                                    Aucune donnée disponible pour la répartition par type.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                            
                            <!-- Tab 2: Transactions récentes -->
                            <div class="tab-pane fade" id="recent-transactions">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-transparent border-0">
                                        <h6 class="mb-0 text-capitalize">Transactions Récentes</h6>
                                    </div>
                                    <div class="card-body p-0">
                                        <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
                                            <table class="table align-items-center mb-0">
                                                <thead>
                                                    <tr>
                                                        <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">ID</th>
                                                        <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Client</th>
                                                        <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Type</th>
                                                        <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Date</th>
                                                        <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Montant</th>
                                                        <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Statut</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for payment in recent_payments %}
                                                    <tr>
                                                        <td>
                                                            <p class="text-xs font-weight-bold mb-0 px-3">#{{ payment.id }}</p>
                                                        </td>
                                                        <td>
                                                            <div class="d-flex px-3 py-1">
                                                                <div class="d-flex flex-column justify-content-center">
                                                                    <h6 class="mb-0 text-sm">{{ payment.membre ? payment.membre.prenom ~ ' ' ~ payment.membre.nom : 'Client #' ~ payment.id }}</h6>
                                                                    <p class="text-xs text-secondary mb-0">{{ payment.membre ? payment.membre.email : 'Email non disponible' }}</p>
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <span class="badge bg-{{ payment.reservationType == 'pack' ? 'info' : 'success' }} px-3">
                                                                {{ payment.reservationType|capitalize|default('Standard') }}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <p class="text-xs text-secondary mb-0 px-3">{{ payment.createdAt ? payment.createdAt|date('d/m/Y H:i') : 'Date inconnue' }}</p>
                                                        </td>
                                                        <td>
                                                            <p class="text-xs font-weight-bold mb-0 px-3">{{ payment.amount|round(2) }} {{ payment.currency|default('dt') }}</p>
                                                        </td>
                                                        <td>
                                                            <span class="badge bg-{{ payment.status == 'completed' ? 'success' : (payment.status == 'pending' ? 'warning' : 'info') }} px-3">
                                                                {{ payment.status|capitalize|default('Complété') }}
                                                            </span>
                                                        </td>
                                                    </tr>
                                                    {% else %}
                                                    <tr>
                                                        <td colspan="6" class="text-center py-4">
                                                            <p class="text-sm text-muted mb-0">Aucune transaction récente disponible.</p>
                                                        </td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Tab 3: Tendances -->
                            <div class="tab-pane fade" id="payments-trends">
                                <div class="row">
                                    <div class="col-12 mb-4">
                                        <div class="card border-0 shadow-sm">
                                            <div class="card-header bg-transparent border-0">
                                                <h6 class="mb-0 text-capitalize">Revenus Mensuels</h6>
                                            </div>
                                            <div class="card-body">
                                                <canvas id="monthly-revenue-chart" height="300"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-lg-6 col-md-12 mb-4">
                                        <div class="card border-0 shadow-sm h-100">
                                            <div class="card-header bg-transparent border-0">
                                                <h6 class="mb-0 text-capitalize">Méthodes de Paiement</h6>
                                            </div>
                                            <div class="card-body">
                                                <canvas id="payment-methods-chart" height="250"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12 mb-4">
                                        <div class="card border-0 shadow-sm h-100">
                                            <div class="card-header bg-transparent border-0">
                                                <h6 class="mb-0 text-capitalize">Prévisions des Revenus</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-6">
                                                        <div class="d-flex flex-column">
                                                            <h6 class="mb-3 text-sm text-muted">Ce mois</h6>
                                                            <h5 class="font-weight-bolder">{{ current_month_amount|round(2) }} dt</h5>
                                                        </div>
                                                    </div>
                                                    <div class="col-6">
                                                        <div class="d-flex flex-column">
                                                            <h6 class="mb-3 text-sm text-muted">Objectif mensuel</h6>
                                                            <h5 class="font-weight-bolder">{{ (current_month_amount * 1.2)|round(2) }} dt</h5>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="progress mt-4 mb-2" style="height: 10px;">
                                                    <div class="progress-bar bg-gradient-primary" role="progressbar" style="width: {{ (current_month_amount / (current_month_amount * 1.2) * 100)|round }}%;" aria-valuenow="{{ (current_month_amount / (current_month_amount * 1.2) * 100)|round }}" aria-valuemin="0" aria-valuemax="100"></div>
                                                </div>
                                                <p class="text-sm mb-0">{{ (current_month_amount / (current_month_amount * 1.2) * 100)|round }}% de l'objectif atteint</p>
                                                
                                                <hr class="my-4">
                                                
                                                <div class="row mt-5">
                                                    <div class="col-6">
                                                        <div class="d-flex flex-column">
                                                            <h6 class="mb-3 text-sm text-muted">Prévision mois prochain</h6>
                                                            <h5 class="font-weight-bolder">{{ (current_month_amount * 1.15)|round(2) }} dt</h5>
                                                        </div>
                                                    </div>
                                                    <div class="col-6">
                                                        <div class="d-flex flex-column">
                                                            <h6 class="mb-3 text-sm text-muted">Prévision trimestre</h6>
                                                            <h5 class="font-weight-bolder">{{ (current_month_amount * 3.5)|round(2) }} dt</h5>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endblock %}
    </main>
{% endblock %}

{% block javascripts %}
    <script src="{{ asset('assets/js/core/popper.min.js') }}"></script>
    <script src="{{ asset('assets/js/core/bootstrap.min.js') }}"></script>
    <script src="{{ asset('assets/js/plugins/perfect-scrollbar.min.js') }}"></script>
    <script src="{{ asset('assets/js/plugins/smooth-scrollbar.min.js') }}"></script>
    <script src="{{ asset('assets/js/soft-ui-dashboard.min.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        // Définir les fonctions de base first - très important
        function toggleSection(header) {
            console.log("Toggle section called");
            const content = header.nextElementSibling;
            const icon = header.querySelector('.toggle-icon i');
            
            if (content.classList.contains('active')) {
                content.classList.remove('active');
                content.style.maxHeight = '0px';
                icon.classList.remove('fa-chevron-up');
                icon.classList.add('fa-chevron-down');
            } else {
                content.classList.add('active');
                content.style.maxHeight = '3000px';
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-up');
            }
        }

        function toggleAllSections() {
            console.log("Toggle all sections called");
            const headers = document.querySelectorAll('.collapsible-header');
            const button = document.getElementById('toggleAllButton');
            let allExpanded = true;
            
            // Vérifier si toutes les sections sont déjà ouvertes
            headers.forEach(header => {
                const content = header.nextElementSibling;
                if (!content.classList.contains('active')) {
                    allExpanded = false;
                }
            });
            
            headers.forEach(header => {
                const content = header.nextElementSibling;
                const icon = header.querySelector('.toggle-icon i');
                
                if (allExpanded) {
                    // Si toutes sont ouvertes, on les ferme
                    content.classList.remove('active');
                    content.style.maxHeight = '0px';
                    icon.classList.remove('fa-chevron-up');
                    icon.classList.add('fa-chevron-down');
                    button.textContent = 'Tout développer';
                } else {
                    // Sinon, on les ouvre
                    content.classList.add('active');
                    content.style.maxHeight = '3000px';
                    icon.classList.remove('fa-chevron-down');
                    icon.classList.add('fa-chevron-up');
                    button.textContent = 'Tout réduire';
                }
            });
        }

        // Initialize Flatpickr for date pickers
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM loaded");
            
            // Initialize all sections as expanded by default
            const headers = document.querySelectorAll('.collapsible-header');
            headers.forEach(header => {
                const content = header.nextElementSibling;
                const icon = header.querySelector('.toggle-icon i');
                content.classList.add('active');
                content.style.maxHeight = '3000px';
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-up');
            });
            
            flatpickr('#startDate', {
                dateFormat: 'Y-m-d',
                onChange: updateChart
            });
            flatpickr('#endDate', {
                dateFormat: 'Y-m-d',
                onChange: updateChart
            });
            
            // Animation for KPI and chart cards
            const kpiCards = document.querySelectorAll('.kpi-card');
            const chartCards = document.querySelectorAll('.chart-card');

            const animateElements = (elements) => {
                elements.forEach((element, index) => {
                    setTimeout(() => {
                        element.classList.add('animate');
                    }, index * 150);
                });
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        if (entry.target.classList.contains('kpi-card')) {
                            animateElements(kpiCards);
                        } else if (entry.target.classList.contains('chart-card')) {
                            animateElements(chartCards);
                        }
                    }
                });
            }, { threshold: 0.2 });

            kpiCards.forEach(card => observer.observe(card));
            chartCards.forEach(card => observer.observe(card));
        });
        
        // Update chart based on date selection
        function updateChart() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            if (startDate && endDate) {
                window.location.href = `{{ path('admin_dashboard') }}?startDate=${startDate}&endDate=${endDate}`;
            }
        }

        // Dropdown menu toggle
        document.querySelectorAll('.dropdown-toggle').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('data-bs-target'));
                if (target.classList.contains('show')) {
                    target.classList.remove('show');
                } else {
                    document.querySelectorAll('.collapse.show').forEach(openMenu => {
                        openMenu.classList.remove('show');
                    });
                    target.classList.add('show');
                }
            });
        });

        // Dynamic data from controller
        const pourcentageTraitees = {{ pourcentage_traitees|default(0)|json_encode|raw }};
        const pourcentageNonTraitees = {{ pourcentage_non_traitees|default(0)|json_encode|raw }};
        const reclamationsParType = {{ reclamations_par_type|default([])|json_encode|raw }};
        const reclamationsParStatut = {{ reclamations_par_statut|default([])|json_encode|raw }};
        const reclamationsByDate = {{ reclamations_by_date|default([])|json_encode|raw }};
        const feedbacksByVote = {{ feedbacks_by_vote|default([])|json_encode|raw }};
        const userEngagement = {{ user_engagement|default([])|json_encode|raw }};
        const reservationsByType = {{ reservations_by_type|default([])|json_encode|raw }};
        const reservationsByStatus = {{ reservations_by_status|default([])|json_encode|raw }};
        const membersByRole = {{ members_by_role|default([])|json_encode|raw }};
        const servicesByType = {{ services_by_type|default([])|json_encode|raw }};
        const topServices = {{ top_services|default([])|json_encode|raw }};
        const packsByType = {{ packs_by_type|default([])|json_encode|raw }};
        const popularPacks = {{ popular_packs|default([])|json_encode|raw }};
        const avgServicesPerSponsor = {{ avg_services_per_sponsor|default(0)|json_encode|raw }};
        const paymentsByType = {{ payments_by_type|default([])|json_encode|raw }};
        const monthlyRevenue = {{ monthly_revenue|default([])|json_encode|raw }};
        
        // Console debug
        console.log('pourcentageTraitees:', pourcentageTraitees);
        console.log('pourcentageNonTraitees:', pourcentageNonTraitees);
        console.log('reclamationsParType:', reclamationsParType);
        console.log('reclamationsParStatut:', reclamationsParStatut);
        console.log('reclamationsByDate:', reclamationsByDate);
        console.log('feedbacksByVote:', feedbacksByVote);
        console.log('userEngagement:', userEngagement);
        console.log('reservationsByType:', reservationsByType);
        console.log('reservationsByStatus:', reservationsByStatus);
        console.log('membersByRole:', membersByRole);
        console.log('servicesByType:', servicesByType);
        console.log('topServices:', topServices);
        console.log('packsByType:', packsByType);
        console.log('popularPacks:', popularPacks);
        console.log('avgServicesPerSponsor:', avgServicesPerSponsor);
        console.log('paymentsByType:', paymentsByType);
        console.log('monthlyRevenue:', monthlyRevenue);

        // Chart: Réclamations par Jour (Line Chart)
        const dateLabels = reclamationsByDate.map(item => item.date || 'Inconnu');
        const dateData = reclamationsByDate.map(item => item.count || 0);
        const hasDateData = dateData.some(count => count > 0);

        const ctxDate = document.getElementById('reclamations-by-date-chart').getContext('2d');
        if (!hasDateData) {
            document.getElementById('no-date-data-message').style.display = 'block';
            ctxDate.canvas.style.display = 'none';
        } else {
            new Chart(ctxDate, {
                type: 'line',
                data: {
                    labels: dateLabels,
                    datasets: [{
                        label: 'Nombre de Réclamations',
                        data: dateData,
                        borderColor: '#3B82F6',
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: {
                                color: '#1F2A44',
                                font: { family: 'Inter', size: 12 },
                                maxRotation: 45,
                                minRotation: 45
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: { color: '#E5E7EB' },
                            ticks: {
                                color: '#1F2A44',
                                font: { family: 'Inter', size: 12 },
                                stepSize: 1
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: { size: 14, family: 'Inter', weight: 500 },
                                color: '#1F2A44'
                            }
                        },
                        tooltip: {
                            backgroundColor: '#1F2A44',
                            titleFont: { size: 14, family: 'Inter' },
                            bodyFont: { size: 12, family: 'Inter' },
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y;
                                }
                            }
                        }
                    },
                    animation: {
                        duration: 1200,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }

        // Chart: Réclamations Traitées vs Non Traitées (Pie Chart)
        const ctx1 = document.getElementById('reclamations-treated-vs-untreated-chart').getContext('2d');
        const hasTreatedData = pourcentageTraitees !== 0 || pourcentageNonTraitees !== 0;
        if (!hasTreatedData) {
            document.getElementById('no-treated-data-message').style.display = 'block';
            ctx1.canvas.style.display = 'none';
        } else {
            new Chart(ctx1, {
                type: 'pie',
                data: {
                    labels: ['Traitées', 'Non Traitées'],
                    datasets: [{
                        data: [pourcentageTraitees, pourcentageNonTraitees],
                        backgroundColor: ['#3B82F6', '#10B981'],
                        borderColor: ['#FFF', '#FFF'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: { size: 14, family: 'Inter', weight: 500 },
                                color: '#1F2A44'
                            }
                        },
                        tooltip: {
                            backgroundColor: '#1F2A44',
                            titleFont: { size: 14, family: 'Inter' },
                            bodyFont: { size: 12, family: 'Inter' },
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.parsed + '%';
                                }
                            }
                        }
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true,
                        duration: 1000,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }

        // Chart: Réclamations par Type (Bar Chart)
        const typeLabels = reclamationsParType.map(item => item.type || 'Inconnu');
        const typeData = reclamationsParType.map(item => item.count || 0);
        const hasTypeData = typeData.some(count => count > 0);

        const ctx2 = document.getElementById('reclamations-by-type-chart').getContext('2d');
        if (!hasTypeData) {
            document.getElementById('no-type-data-message').style.display = 'block';
            ctx2.canvas.style.display = 'none';
        } else {
            new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: typeLabels,
                    datasets: [{
                        label: 'Nombre de Réclamations',
                        data: typeData,
                        backgroundColor: ['#3B82F6', '#10B981', '#F59E0B', '#60A5FA'],
                        borderColor: ['#3B82F6', '#10B981', '#F59E0B', '#60A5FA'],
                        borderWidth: 1,
                        borderRadius: 8,
                        barThickness: 40
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: {
                                color: '#1F2A44',
                                font: { family: 'Inter', size: 12 },
                                maxRotation: 45,
                                minRotation: 45
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: { color: '#E5E7EB' },
                            ticks: {
                                color: '#1F2A44',
                                font: { family: 'Inter', size: 12 },
                                stepSize: 1
                            }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#1F2A44',
                            titleFont: { size: 14, family: 'Inter' },
                            bodyFont: { size: 12, family: 'Inter' },
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y;
                                }
                            }
                        }
                    },
                    animation: { duration: 1200, easing: 'easeOutQuart' }
                }
            });
        }

              // Chart: Réclamations par Statut (Doughnut Chart)
        const statusLabels = reclamationsParStatut.map(item => item.statut || 'Inconnu');
        const statusData = reclamationsParStatut.map(item => item.count || 0);
        const hasStatusData = statusData.some(count => count > 0);

        const ctx3 = document.getElementById('reclamations-status-distribution-chart').getContext('2d');
        if (!hasStatusData) {
            document.getElementById('no-status-data-message').style.display = 'block';
            ctx3.canvas.style.display = 'none';
        } else {
            new Chart(ctx3, {
                type: 'doughnut',
                data: {
                    labels: statusLabels,
                    datasets: [{
                        data: statusData,
                        backgroundColor: ['#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6'],
                        borderColor: ['#FFF', '#FFF', '#FFF', '#FFF', '#FFF'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: { size: 14, family: 'Inter', weight: 500 },
                                color: '#1F2A44'
                            }
                        },
                        tooltip: {
                            backgroundColor: '#1F2A44',
                            titleFont: { size: 14, family: 'Inter' },
                            bodyFont: { size: 12, family: 'Inter' },
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.parsed;
                                }
                            }
                        }
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true,
                        duration: 1000,
                        easing: 'easeOutQuart'
                    },
                    cutout: '70%'
                }
            });
        }

        // Chart: Feedbacks par Tranche de Note (Bar Chart)
        const voteLabels = feedbacksByVote.map(item => 'Note ' + (item.vote || '0'));
        const voteData = feedbacksByVote.map(item => item.count || 0);
        const hasVoteData = voteData.some(count => count > 0);

        const ctx4 = document.getElementById('feedbacks-by-vote-chart').getContext('2d');
        if (!hasVoteData) {
            document.getElementById('no-vote-data-message').style.display = 'block';
            ctx4.canvas.style.display = 'none';
        } else {
            new Chart(ctx4, {
                type: 'bar',
                data: {
                    labels: voteLabels,
                    datasets: [{
                        label: 'Nombre de Feedbacks',
                        data: voteData,
                        backgroundColor: ['#3B82F6', '#60A5FA', '#93C5FD', '#BFDBFE', '#DBEAFE'],
                        borderColor: ['#3B82F6', '#60A5FA', '#93C5FD', '#BFDBFE', '#DBEAFE'],
                        borderWidth: 1,
                        borderRadius: 8,
                        barThickness: 40
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: {
                                color: '#1F2A44',
                                font: { family: 'Inter', size: 12 }
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: { color: '#E5E7EB' },
                            ticks: {
                                color: '#1F2A44',
                                font: { family: 'Inter', size: 12 },
                                stepSize: 1
                            }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#1F2A44',
                            titleFont: { size: 14, family: 'Inter' },
                            bodyFont: { size: 12, family: 'Inter' },
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y;
                                }
                            }
                        }
                    },
                    animation: { duration: 1200, easing: 'easeOutQuart' }
                }
            });
        }

        // Chart: Engagement des Utilisateurs (Horizontal Bar Chart)
        const engagementLabels = userEngagement.map(item => item.email || 'Inconnu');
        const engagementData = userEngagement.map(item => item.feedbackCount || 0);
        const hasEngagementData = engagementData.some(count => count > 0);

        const ctx5 = document.getElementById('user-engagement-chart').getContext('2d');
        if (!hasEngagementData) {
            document.getElementById('no-engagement-data-message').style.display = 'block';
            ctx5.canvas.style.display = 'none';
        } else {
            new Chart(ctx5, {
                type: 'bar',
                data: {
                    labels: engagementLabels,
                    datasets: [{
                        label: 'Nombre de Feedbacks',
                        data: engagementData,
                        backgroundColor: '#3B82F6',
                        borderColor: '#3B82F6',
                        borderWidth: 1,
                        borderRadius: 8
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: { color: '#E5E7EB' },
                            ticks: {
                                color: '#1F2A44',
                                font: { family: 'Inter', size: 12 },
                                stepSize: 1
                            }
                        },
                        y: {
                            grid: { display: false },
                            ticks: {
                                color: '#1F2A44',
                                font: { family: 'Inter', size: 12 }
                            }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#1F2A44',
                            titleFont: { size: 14, family: 'Inter' },
                            bodyFont: { size: 12, family: 'Inter' },
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.x;
                                }
                            }
                        }
                    },
                    animation: { duration: 1200, easing: 'easeOutQuart' }
                }
            });
        }

        // Chart: Réservations par Type (Pie Chart)
        const reservationsTypeLabels = reservationsByType.map(item => item.type || 'Inconnu');
        const reservationsTypeData = reservationsByType.map(item => item.count || 0);
        const hasReservationsTypeData = reservationsTypeData.some(count => count > 0);

        const ctx6 = document.getElementById('reservations-by-type-chart').getContext('2d');
        if (!hasReservationsTypeData) {
            document.getElementById('no-reservations-type-data-message').style.display = 'block';
            ctx6.canvas.style.display = 'none';
        } else {
            new Chart(ctx6, {
                type: 'pie',
                data: {
                    labels: reservationsTypeLabels,
                    datasets: [{
                        data: reservationsTypeData,
                        backgroundColor: ['#3B82F6', '#10B981'],
                        borderColor: ['#FFF', '#FFF'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: { size: 14, family: 'Inter', weight: 500 },
                                color: '#1F2A44'
                            }
                        },
                        tooltip: {
                            backgroundColor: '#1F2A44',
                            titleFont: { size: 14, family: 'Inter' },
                            bodyFont: { size: 12, family: 'Inter' },
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.parsed;
                                }
                            }
                        }
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true,
                        duration: 1000,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }

        // Chart: Réservations par Statut (Doughnut Chart)
        const reservationsStatusLabels = reservationsByStatus.map(item => item.status || 'Inconnu');
        const reservationsStatusData = reservationsByStatus.map(item => item.count || 0);
        const hasReservationsStatusData = reservationsStatusData.some(count => count > 0);

        const ctx7 = document.getElementById('reservations-by-status-chart').getContext('2d');
        if (!hasReservationsStatusData) {
            document.getElementById('no-reservations-status-data-message').style.display = 'block';
            ctx7.canvas.style.display = 'none';
        } else {
            new Chart(ctx7, {
                type: 'doughnut',
                data: {
                    labels: reservationsStatusLabels,
                    datasets: [{
                        data: reservationsStatusData,
                        backgroundColor: ['#3B82F6', '#10B981', '#F59E0B', '#EF4444'],
                        borderColor: ['#FFF', '#FFF', '#FFF', '#FFF'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: { size: 14, family: 'Inter', weight: 500 },
                                color: '#1F2A44'
                            }
                        },
                        tooltip: {
                            backgroundColor: '#1F2A44',
                            titleFont: { size: 14, family: 'Inter' },
                            bodyFont: { size: 12, family: 'Inter' },
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.parsed;
                                }
                            }
                        }
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true,
                        duration: 1000,
                        easing: 'easeOutQuart'
                    },
                    cutout: '70%'
                }
            });
        }

        // Chart: Répartition par Rôle (Polar Area Chart)
        const roleLabels = membersByRole.map(item => item.role || 'Inconnu');
        const roleData = membersByRole.map(item => item.count || 0);
        const hasRoleData = roleData.some(count => count > 0);

        const ctx8 = document.getElementById('members-by-role-chart').getContext('2d');
        if (!hasRoleData) {
            document.getElementById('no-members-role-data-message').style.display = 'block';
            ctx8.canvas.style.display = 'none';
        } else {
            new Chart(ctx8, {
                type: 'polarArea',
                data: {
                    labels: roleLabels,
                    datasets: [{
                        data: roleData,
                        backgroundColor: ['#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6'],
                        borderColor: ['#FFF', '#FFF', '#FFF', '#FFF', '#FFF'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: { size: 14, family: 'Inter', weight: 500 },
                                color: '#1F2A44'
                            }
                        },
                        tooltip: {
                            backgroundColor: '#1F2A44',
                            titleFont: { size: 14, family: 'Inter' },
                            bodyFont: { size: 12, family: 'Inter' },
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.parsed.r;
                                }
                            }
                        }
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true,
                        duration: 1000,
                        easing: 'easeOutQuart'
                    },
                    scales: {
                        r: {
                            grid: { color: '#E5E7EB' },
                            ticks: {
                                display: false,
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        // Chart: Services par Type (Bar Chart)
        const servicesTypeLabels = servicesByType.map(item => item.type_service || 'Inconnu');
        const servicesTypeData = servicesByType.map(item => item.count || 0);
        const hasServicesTypeData = servicesTypeData.some(count => count > 0);

        const ctx9 = document.getElementById('services-by-type-chart').getContext('2d');
        if (!hasServicesTypeData) {
            document.getElementById('no-services-type-data-message').style.display = 'block';
            ctx9.canvas.style.display = 'none';
        } else {
            new Chart(ctx9, {
                type: 'bar',
                data: {
                    labels: servicesTypeLabels,
                    datasets: [{
                        label: 'Nombre de Services',
                        data: servicesTypeData,
                        backgroundColor: ['#3B82F6', '#10B981', '#F59E0B', '#8B5CF6'],
                        borderColor: ['#3B82F6', '#10B981', '#F59E0B', '#8B5CF6'],
                        borderWidth: 1,
                        borderRadius: 8,
                        barThickness: 40
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: {
                                color: '#1F2A44',
                                font: { family: 'Inter', size: 12 },
                                maxRotation: 45,
                                minRotation: 45
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: { color: '#E5E7EB' },
                            ticks: {
                                color: '#1F2A44',
                                font: { family: 'Inter', size: 12 },
                                stepSize: 1
                            }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#1F2A44',
                            titleFont: { size: 14, family: 'Inter' },
                            bodyFont: { size: 12, family: 'Inter' },
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y;
                                }
                            }
                        }
                    },
                    animation: { duration: 1200, easing: 'easeOutQuart' }
                }
            });
        }

        // Chart: Top Services Réservés (Horizontal Bar Chart)
        const topServicesLabels = topServices.map(item => item.titre || 'Inconnu');
        const topServicesData = topServices.map(item => item.count || 0);
        const hasTopServicesData = topServicesData.some(count => count > 0);

        const ctx10 = document.getElementById('top-services-chart').getContext('2d');
        if (!hasTopServicesData) {
            document.getElementById('no-top-services-data-message').style.display = 'block';
            ctx10.canvas.style.display = 'none';
        } else {
            new Chart(ctx10, {
                type: 'bar',
                data: {
                    labels: topServicesLabels,
                    datasets: [{
                        label: 'Nombre de Réservations',
                        data: topServicesData,
                        backgroundColor: '#3B82F6',
                        borderColor: '#3B82F6',
                        borderWidth: 1,
                        borderRadius: 8
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: { color: '#E5E7EB' },
                            ticks: {
                                color: '#1F2A44',
                                font: { family: 'Inter', size: 12 },
                                stepSize: 1
                            }
                        },
                        y: {
                            grid: { display: false },
                            ticks: {
                                color: '#1F2A44',
                                font: { family: 'Inter', size: 12 }
                            }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#1F2A44',
                            titleFont: { size: 14, family: 'Inter' },
                            bodyFont: { size: 12, family: 'Inter' },
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.x;
                                }
                            }
                        }
                    },
                    animation: { duration: 1200, easing: 'easeOutQuart' }
                }
            });
        }

        // Chart: Packs par Type (Doughnut Chart)
        const packsTypeLabels = packsByType.map(item => item.type || 'Inconnu');
        const packsTypeData = packsByType.map(item => item.count || 0);
        const hasPacksTypeData = packsTypeData.some(count => count > 0);

        const ctx11 = document.getElementById('packs-by-type-chart').getContext('2d');
        if (!hasPacksTypeData) {
            document.getElementById('no-packs-type-data-message').style.display = 'block';
            ctx11.canvas.style.display = 'none';
        } else {
            new Chart(ctx11, {
                type: 'doughnut',
                data: {
                    labels: packsTypeLabels,
                    datasets: [{
                        data: packsTypeData,
                        backgroundColor: ['#3B82F6', '#10B981', '#F59E0B', '#8B5CF6'],
                        borderColor: ['#FFF', '#FFF', '#FFF', '#FFF'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: { size: 14, family: 'Inter', weight: 500 },
                                color: '#1F2A44'
                            }
                        },
                        tooltip: {
                            backgroundColor: '#1F2A44',
                            titleFont: { size: 14, family: 'Inter' },
                            bodyFont: { size: 12, family: 'Inter' },
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.parsed;
                                }
                            }
                        }
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true,
                        duration: 1000,
                        easing: 'easeOutQuart'
                    },
                    cutout: '70%'
                }
            });
        }

        // Chart: Packs Populaires (Bar Chart)
        const popularPacksLabels = popularPacks.map(item => item.nomPack || 'Inconnu');
        const popularPacksData = popularPacks.map(item => item.count || 0);
        const hasPopularPacksData = popularPacksData.some(count => count > 0);

        const ctx12 = document.getElementById('popular-packs-chart').getContext('2d');
        if (!hasPopularPacksData) {
            document.getElementById('no-popular-packs-data-message').style.display = 'block';
            ctx12.canvas.style.display = 'none';
        } else {
            new Chart(ctx12, {
                type: 'bar',
                data: {
                    labels: popularPacksLabels,
                    datasets: [{
                        label: 'Nombre de Réservations',
                        data: popularPacksData,
                        backgroundColor: '#3B82F6',
                        borderColor: '#3B82F6',
                        borderWidth: 1,
                        borderRadius: 8,
                        barThickness: 40
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: {
                                color: '#1F2A44',
                                font: { family: 'Inter', size: 12 },
                                maxRotation: 45,
                                minRotation: 45
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: { color: '#E5E7EB' },
                            ticks: {
                                color: '#1F2A44',
                                font: { family: 'Inter', size: 12 },
                                stepSize: 1
                            }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#1F2A44',
                            titleFont: { size: 14, family: 'Inter' },
                            bodyFont: { size: 12, family: 'Inter' },
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y;
                                }
                            }
                        }
                    },
                    animation: { duration: 1200, easing: 'easeOutQuart' }
                }
            });
        }

        // Chart: Paiements par Type (Doughnut Chart)
        const paymentTypeLabels = paymentsByType.map(item => (item.type ? item.type.charAt(0).toUpperCase() + item.type.slice(1) : 'Inconnu'));
        const paymentTypeData = paymentsByType.map(item => parseFloat(item.total) || 0);
        const paymentTypeCount = paymentsByType.map(item => parseInt(item.count) || 0);
        const hasPaymentTypeData = paymentTypeData.some(total => total > 0);

        const ctx13 = document.getElementById('payments-by-type-chart').getContext('2d');
        if (!hasPaymentTypeData) {
            document.getElementById('no-payments-type-data-message').style.display = 'block';
            ctx13.canvas.style.display = 'none';
        } else {
            new Chart(ctx13, {
                type: 'doughnut',
                data: {
                    labels: paymentTypeLabels,
                    datasets: [{
                        data: paymentTypeData,
                        backgroundColor: ['#3B82F6', '#10B981', '#F59E0B', '#8B5CF6'],
                        borderColor: ['#FFF', '#FFF', '#FFF', '#FFF'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: { size: 14, family: 'Inter', weight: 500 },
                                color: '#1F2A44'
                            }
                        },
                        tooltip: {
                            backgroundColor: '#1F2A44',
                            titleFont: { size: 14, family: 'Inter' },
                            bodyFont: { size: 12, family: 'Inter' },
                            callbacks: {
                                label: function(context) {
                                    const total = context.parsed;
                                    return context.label + ': ' + total.toFixed(2) + ' dt';
                                }
                            }
                        }
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true,
                        duration: 1000,
                        easing: 'easeOutQuart'
                    },
                    cutout: '70%'
                }
            });
        }

        // Chart: Évolution des paiements (Line Chart)
        // Données fictives pour l'exemple - remplacer par des données réelles
        const currentDate = new Date();
        const daysInMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0).getDate();
        
        const paymentTrendLabels = [];
        const paymentTrendData = [];
        let cumulativeTotal = 0;
        
        for (let i = 1; i <= daysInMonth; i++) {
            if (i <= currentDate.getDate()) {
                const dailyAmount = Math.floor(Math.random() * 500) + 100; // Montant fictif entre 100 et 600
                cumulativeTotal += dailyAmount;
                paymentTrendLabels.push(i);
                paymentTrendData.push(cumulativeTotal);
            }
        }
        
        const ctxTrend = document.getElementById('payments-trend-chart').getContext('2d');
        new Chart(ctxTrend, {
            type: 'line',
            data: {
                labels: paymentTrendLabels,
                datasets: [
                    {
                        label: 'Revenu Cumulé (dt)',
                        data: paymentTrendData,
                        borderColor: '#3B82F6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 3,
                        pointBackgroundColor: '#3B82F6',
                        pointBorderColor: 'white',
                        pointBorderWidth: 2,
                        pointHoverRadius: 6
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        grid: { display: false },
                        title: {
                            display: true,
                            text: 'Jours du mois',
                            color: '#6B7280',
                            font: { size: 12 }
                        }
                    },
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(229, 231, 235, 0.4)' },
                        title: {
                            display: true,
                            text: 'Montant (dt)',
                            color: '#6B7280',
                            font: { size: 12 }
                        },
                        ticks: {
                            callback: function(value) {
                                return value + ' dt';
                            }
                        }
                    }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(31, 42, 68, 0.8)',
                        titleFont: { size: 13 },
                        bodyFont: { size: 12 },
                        callbacks: {
                            title: function(tooltipItems) {
                                return 'Jour ' + tooltipItems[0].label;
                            },
                            label: function(context) {
                                return 'Montant: ' + context.parsed.y + ' dt';
                            }
                        }
                    }
                },
                interaction: {
                    intersect: false,
                    mode: 'index'
                }
            }
        });

        // Revenus mensuels (Barchart) - Onglet Tendances
        const monthNames = ['Jan', 'Fév', 'Mar', 'Avr', 'Mai', 'Jun', 'Jul', 'Aoû', 'Sep', 'Oct', 'Nov', 'Déc'];
        const monthlyData = [];
        
        for (let i = 0; i < 12; i++) {
            // Générer des données fictives pour l'exemple
            // La distribution est plus élevée pour certains mois (été et fêtes)
            let amount;
            if (i >= 5 && i <= 7) { // Juin, Juillet, Août (été)
                amount = Math.floor(Math.random() * 5000) + 8000;
            } else if (i === 11 || i === 0) { // Décembre, Janvier (fêtes)
                amount = Math.floor(Math.random() * 4000) + 7000;
            } else {
                amount = Math.floor(Math.random() * 3000) + 3000;
            }
            monthlyData.push(amount);
        }
        
        const ctxMonthly = document.getElementById('monthly-revenue-chart').getContext('2d');
        new Chart(ctxMonthly, {
            type: 'bar',
            data: {
                labels: monthNames,
                datasets: [
                    {
                        label: 'Revenus Mensuels',
                        data: monthlyData,
                        backgroundColor: function(context) {
                            const index = context.dataIndex;
                            return index === new Date().getMonth() 
                                ? 'rgba(59, 130, 246, 0.9)' 
                                : 'rgba(59, 130, 246, 0.4)';
                        },
                        borderRadius: 6,
                        barThickness: 20,
                        maxBarThickness: 25
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { grid: { display: false } },
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(229, 231, 235, 0.4)' },
                        ticks: {
                            callback: function(value) {
                                return value / 1000 + 'k';
                            }
                        }
                    }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(31, 42, 68, 0.8)',
                        callbacks: {
                            label: function(context) {
                                return 'Revenu: ' + context.parsed.y + ' dt';
                            }
                        }
                    }
                }
            }
        });

        // Méthodes de paiement (Pie chart)
        const paymentMethods = ['Carte bancaire', 'Virement', 'Paiement à la livraison', 'PayPal'];
        const paymentMethodsData = [65, 15, 12, 8]; // Pourcentages fictifs
        
        const ctxMethods = document.getElementById('payment-methods-chart').getContext('2d');
        new Chart(ctxMethods, {
            type: 'pie',
            data: {
                labels: paymentMethods,
                datasets: [
                    {
                        data: paymentMethodsData,
                        backgroundColor: ['#3B82F6', '#10B981', '#F59E0B', '#8B5CF6'],
                        borderWidth: 0
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                        align: 'center',
                        labels: {
                            boxWidth: 15,
                            padding: 15,
                            font: { size: 12 }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.label + ': ' + context.parsed + '%';
                            }
                        }
                    }
                }
            }
        });

        // Écouteur d'événements pour le sélecteur de période
        document.getElementById('payment-chart-period').addEventListener('change', function() {
            // Ici, vous pourriez recharger les données en fonction de la période sélectionnée
            console.log('Période sélectionnée:', this.value);
            // Dans une implémentation réelle, appel AJAX pour récupérer de nouvelles données
        });

        // Écouteur d'événements pour le sélecteur de période
        document.getElementById('payment-chart-period').addEventListener('change', function() {
            // Ici, vous pourriez recharger les données en fonction de la période sélectionnée
            console.log('Période sélectionnée:', this.value);
            // Dans une implémentation réelle, appel AJAX pour récupérer de nouvelles données
        });

        // Graphiques pour la section Réservations
        
        // Réservations par type (Doughnut chart)
        const reservationTypeData = [
            {% for type in reservations_by_type %}
                {{ type.count }},
            {% endfor %}
        ];
        const reservationTypeLabels = [
            {% for type in reservations_by_type %}
                '{{ type.type }}',
            {% endfor %}
        ];
        
        const ctxReservationType = document.getElementById('reservation-type-chart').getContext('2d');
        new Chart(ctxReservationType, {
            type: 'doughnut',
            data: {
                labels: reservationTypeLabels,
                datasets: [{
                    data: reservationTypeData,
                    backgroundColor: ['#3B82F6', '#10B981'],
                    borderColor: ['#FFF', '#FFF'],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            font: { size: 12, family: 'Inter' },
                            boxWidth: 12
                        }
                    },
                    tooltip: {
                        backgroundColor: '#1F2A44',
                        callbacks: {
                            label: function(context) {
                                const percent = Math.round((context.parsed / reservationTypeData.reduce((a, b) => a + b, 0)) * 100);
                                return context.label + ': ' + context.parsed + ' (' + percent + '%)';
                            }
                        }
                    }
                },
                cutout: '65%'
            }
        });
        
        // Statut des réservations (Pie chart)
        const reservationStatusLabels = {{ reservations_by_status|default([{ status: 'Confirmé', count: 20 }, { status: 'En attente', count: 15 }, { status: 'Annulé', count: 5 }, { status: 'Refusé', count: 2 }])|json_encode|raw }}.map(item => item.status);
        const reservationStatusData = {{ reservations_by_status|default([{ status: 'Confirmé', count: 20 }, { status: 'En attente', count: 15 }, { status: 'Annulé', count: 5 }, { status: 'Refusé', count: 2 }])|json_encode|raw }}.map(item => item.count);
        
        const ctxReservationStatus = document.getElementById('reservation-status-chart').getContext('2d');
        new Chart(ctxReservationStatus, {
            type: 'pie',
            data: {
                labels: reservationStatusLabels,
                datasets: [{
                    data: reservationStatusData,
                    backgroundColor: ['#10B981', '#3B82F6', '#F59E0B', '#EF4444'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                        align: 'center',
                        labels: { font: { size: 12 } }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percent = Math.round((context.parsed / total) * 100);
                                return context.label + ': ' + context.parsed + ' (' + percent + '%)';
                            }
                        }
                    }
                }
            }
        });
        
        // Tendance des réservations (Line chart)
        // Générer des données de tendance fictives
        const trendLabels = [];
        const trendData = [];
        
        // Générer les dates des 30 derniers jours
        for (let i = 29; i >= 0; i--) {
            const date = new Date();
            date.setDate(date.getDate() - i);
            trendLabels.push(date.toLocaleDateString('fr-FR', { day: '2-digit', month: '2-digit' }));
            
            // Générer des données aléatoires pour la démonstration
            // Plus de réservations les weekends, par exemple
            const dayOfWeek = date.getDay();
            let value;
            if (dayOfWeek === 0 || dayOfWeek === 6) { // Weekend
                value = Math.floor(Math.random() * 10) + 15; // 15-25 réservations
            } else {
                value = Math.floor(Math.random() * 10) + 5; // 5-15 réservations
            }
            trendData.push(value);
        }
        
        const ctxReservationTrend = document.getElementById('reservations-trend-chart').getContext('2d');
        new Chart(ctxReservationTrend, {
            type: 'line',
            data: {
                labels: trendLabels,
                datasets: [{
                    label: 'Nombre de réservations',
                    data: trendData,
                    borderColor: '#3B82F6',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    fill: true,
                    tension: 0.3,
                    borderWidth: 3,
                    pointRadius: 3,
                    pointBackgroundColor: '#3B82F6',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { 
                        grid: { display: false },
                        ticks: {
                            maxTicksLimit: 10,
                            font: { size: 10 }
                        }
                    },
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(229, 231, 235, 0.4)' },
                        ticks: { precision: 0 }
                    }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(31, 41, 55, 0.8)',
                        callbacks: {
                            title: function(items) {
                                return 'Date: ' + items[0].label;
                            },
                            label: function(context) {
                                return 'Réservations: ' + context.parsed.y;
                            }
                        }
                    }
                },
                interaction: {
                    mode: 'index',
                    intersect: false
                }
            }
        });
        
        // Valeur moyenne par type (Bar chart)
        const avgValueLabels = ['Pack Standard', 'Pack Premium', 'Pack VIP', 'Personnalisé'];
        const avgValueData = [250, 450, 650, 380];
        
        const ctxAvgValue = document.getElementById('avg-value-chart').getContext('2d');
        new Chart(ctxAvgValue, {
            type: 'bar',
            data: {
                labels: avgValueLabels,
                datasets: [{
                    label: 'Valeur moyenne (dt)',
                    data: avgValueData,
                    backgroundColor: [
                        'rgba(59, 130, 246, 0.7)',
                        'rgba(16, 185, 129, 0.7)',
                        'rgba(245, 158, 11, 0.7)',
                        'rgba(139, 92, 246, 0.7)'
                    ],
                    borderRadius: 5,
                    maxBarThickness: 25
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { grid: { display: false } },
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(229, 231, 235, 0.4)' },
                        ticks: {
                            callback: function(value) {
                                return value + ' dt';
                            }
                        }
                    }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.parsed.y + ' dt';
                            }
                        }
                    }
                }
            }
        });
        
        // Écouteur d'événements pour le sélecteur de période des réservations
        document.getElementById('reservation-trend-period').addEventListener('change', function() {
            console.log('Période sélectionnée pour réservations:', this.value);
            // Dans une implémentation réelle, appel AJAX pour récupérer de nouvelles données
        });
        
        // Initialisation des graphiques pour la section Paiements
        
        // Paiements par type (Doughnut chart)
        const alternativePaymentTypeData = [
            {% for type in payments_by_type %}
                {{ type.total }},
            {% endfor %}
        ];
        const alternativePaymentTypeLabels = [
            {% for type in payments_by_type %}
                '{{ type.type|capitalize }}',
            {% endfor %}
        ];
        
        const ctxPaymentType = document.getElementById('payments-by-type-chart').getContext('2d');
        new Chart(ctxPaymentType, {
            type: 'doughnut',
            data: {
                labels: alternativePaymentTypeLabels.length > 0 ? alternativePaymentTypeLabels : ['Pack', 'Personnalisé'],
                datasets: [{
                    data: alternativePaymentTypeData.length > 0 ? alternativePaymentTypeData : [70, 30],
                    backgroundColor: ['#3B82F6', '#10B981', '#F59E0B', '#8B5CF6'],
                    borderColor: ['#FFF', '#FFF', '#FFF', '#FFF'],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            font: { size: 12, family: 'Inter' },
                            boxWidth: 12,
                            padding: 20
                        }
                    },
                    tooltip: {
                        backgroundColor: '#1F2A44',
                        callbacks: {
                            label: function(context) {
                                const value = context.parsed;
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = Math.round((value / total) * 100);
                                return `${context.label}: ${value.toFixed(2)} dt (${percentage}%)`;
                            }
                        }
                    }
                },
                cutout: '65%'
            }
        });
        
        // Évolution des paiements (Line chart)
        const dailyLabels = {{ daily_data|default([])|json_encode|raw }}.map(item => `Jour ${item.day}`);
        const dailyAmounts = {{ daily_data|default([])|json_encode|raw }}.map(item => item.amount);
        
        const ctxPaymentsTrend = document.getElementById('payments-trend-chart').getContext('2d');
        new Chart(ctxPaymentsTrend, {
            type: 'line',
            data: {
                labels: dailyLabels.length > 0 ? dailyLabels : Array.from({length: 30}, (_, i) => `Jour ${i+1}`),
                datasets: [{
                    label: 'Montant quotidien (dt)',
                    data: dailyAmounts.length > 0 ? dailyAmounts : Array.from({length: 30}, () => Math.floor(Math.random() * 500) + 100),
                    borderColor: '#3B82F6',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    fill: true,
                    tension: 0.4,
                    pointRadius: 3,
                    pointBackgroundColor: '#3B82F6',
                    pointBorderColor: '#FFF',
                    pointBorderWidth: 2,
                    pointHoverRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { 
                        grid: { display: false },
                        ticks: {
                            maxTicksLimit: 10,
                            font: { size: 10 }
                        }
                    },
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(229, 231, 235, 0.4)' },
                        ticks: {
                            callback: function(value) {
                                return value + ' dt';
                            }
                        }
                    }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(31, 41, 55, 0.8)',
                        callbacks: {
                            title: function(items) {
                                return items[0].label;
                            },
                            label: function(context) {
                                return `Montant: ${context.parsed.y} dt`;
                            }
                        }
                    }
                },
                interaction: {
                    mode: 'index',
                    intersect: false
                }
            }
        });
        
        // Revenus mensuels (Bar chart)
        const monthlyLabels = {{ monthly_revenue|default([])|json_encode|raw }}.map(item => item.month);
        const monthlyAmounts = {{ monthly_revenue|default([])|json_encode|raw }}.map(item => item.total);
        
        const ctxMonthlyRevenue = document.getElementById('monthly-revenue-chart').getContext('2d');
        new Chart(ctxMonthlyRevenue, {
            type: 'bar',
            data: {
                labels: monthlyLabels.length > 0 ? monthlyLabels : ['01/23', '02/23', '03/23', '04/23', '05/23', '06/23', '07/23', '08/23', '09/23', '10/23', '11/23', '12/23'],
                datasets: [{
                    label: 'Revenu mensuel (dt)',
                    data: monthlyAmounts.length > 0 ? monthlyAmounts : [5200, 6100, 5800, 6800, 7200, 8500, 9800, 9500, 8200, 7500, 8800, 9200],
                    backgroundColor: function(context) {
                        const index = context.dataIndex;
                        return context.dataIndex === context.dataset.data.length - 1 
                            ? 'rgba(59, 130, 246, 0.9)' 
                            : 'rgba(59, 130, 246, 0.5)';
                    },
                    borderRadius: 6,
                    maxBarThickness: 30
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { grid: { display: false } },
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(229, 231, 235, 0.4)' },
                        ticks: {
                            callback: function(value) {
                                return value > 999 ? value/1000 + 'k dt' : value + ' dt';
                            }
                        }
                    }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(31, 41, 55, 0.8)',
                        callbacks: {
                            label: function(context) {
                                return `Revenu: ${context.parsed.y} dt`;
                            }
                        }
                    }
                }
            }
        });
        
        // Méthodes de paiement (Pie chart)
        const ctxPaymentMethods = document.getElementById('payment-methods-chart').getContext('2d');
        new Chart(ctxPaymentMethods, {
            type: 'pie',
            data: {
                labels: ['Carte bancaire', 'Virement', 'Paiement à la livraison', 'PayPal'],
                datasets: [{
                    data: [65, 15, 12, 8],
                    backgroundColor: ['#3B82F6', '#10B981', '#F59E0B', '#8B5CF6'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                        align: 'center',
                        labels: {
                            boxWidth: 15,
                            padding: 15,
                            font: { size: 12 }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.label + ': ' + context.parsed + '%';
                            }
                        }
                    }
                }
            }
        });
        
        // Graphiques pour l'analyse de sentiment et améliorations des feedbacks
        
        // Répartition du sentiment
        const ctxSentimentDistribution = document.getElementById('sentiment-distribution-chart');
        if (ctxSentimentDistribution) {
            new Chart(ctxSentimentDistribution, {
                type: 'doughnut',
                data: {
                    labels: ['Positif', 'Neutre', 'Négatif'],
                    datasets: [{
                        data: [
                            {{ ((feedbacks_by_vote|filter(f => f.vote >= 4)|reduce((sum, f) => sum + f.count, 0)) / (feedbacks_by_vote|reduce((sum, f) => sum + f.count, 0)) * 100)|round(1) }},
                            {{ ((feedbacks_by_vote|filter(f => f.vote == 3)|reduce((sum, f) => sum + f.count, 0)) / (feedbacks_by_vote|reduce((sum, f) => sum + f.count, 0)) * 100)|round(1) }},
                            {{ ((feedbacks_by_vote|filter(f => f.vote <= 2)|reduce((sum, f) => sum + f.count, 0)) / (feedbacks_by_vote|reduce((sum, f) => sum + f.count, 0)) * 100)|round(1) }}
                        ],
                        backgroundColor: ['#10B981', '#F59E0B', '#EF4444'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: { size: 12 },
                                boxWidth: 12,
                                padding: 15
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(31, 41, 55, 0.8)',
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.parsed + '%';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Évolution du sentiment (données simulées pour exemple)
        const ctxSentimentTrend = document.getElementById('sentiment-trend-chart');
        if (ctxSentimentTrend) {
            // Simulating data - replace with real data in production
            const sentimentLabels = ['Jan', 'Fév', 'Mar', 'Avr', 'Mai', 'Juin', 'Juil', 'Août', 'Sep', 'Oct', 'Nov', 'Déc'];
            const positiveData = [65, 68, 72, 74, 70, 75, 77, 80, 79, 82, 81, 85];
            const neutralData = [25, 22, 20, 19, 22, 18, 17, 15, 16, 13, 15, 12];
            const negativeData = [10, 10, 8, 7, 8, 7, 6, 5, 5, 5, 4, 3];
            
            new Chart(ctxSentimentTrend, {
                type: 'line',
                data: {
                    labels: sentimentLabels,
                    datasets: [
                        {
                            label: 'Positif',
                            data: positiveData,
                            borderColor: '#10B981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointRadius: 2
                        },
                        {
                            label: 'Neutre',
                            data: neutralData,
                            borderColor: '#F59E0B',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointRadius: 2
                        },
                        {
                            label: 'Négatif',
                            data: negativeData,
                            borderColor: '#EF4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointRadius: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(229, 231, 235, 0.4)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            stacked: true
                        }
                    },
                    plugins: {
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(31, 41, 55, 0.8)',
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y + '%';
                                }
                            }
                        },
                        legend: {
                            position: 'top',
                            labels: {
                                boxWidth: 12,
                                padding: 15,
                                font: { size: 12 }
                            }
                        }
                    }
                }
            });
        }
    </script>
{% endblock %}
        