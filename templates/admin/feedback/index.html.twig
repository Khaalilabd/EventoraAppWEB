{% extends 'admin/dashboard.html.twig' %}

{% block title %}Feedbacks - Tableau{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        /* Importation des polices */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        /* Variables de couleurs et thème */
        :root {
            --primary-gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            --secondary-gradient: linear-gradient(135deg, #22c55e 0%, #10b981 100%);
            --card-shadow: 0 5px 15px -5px rgba(0, 0, 0, 0.05), 0 3px 5px -2px rgba(0, 0, 0, 0.02);
            --hover-shadow: 0 10px 25px -10px  rgba(0, 0, 0, 0.1), 0 5px 10px -5px rgba(0, 0, 0, 0.05);
            --card-border-radius: 12px;
            --card-header-height: 90px;
            --transition-speed: 0.3s;
        }

        /* Général */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
            color: #1e293b;
            overflow-x: hidden;
        }

        /* Conteneur principal */
        .feedback-container {
            margin-left: 270px;
            padding: 20px;
            transition: margin-left 0.3s ease;
        }

        /* Design des cartes de feedback */
        .feedback-card {
            background-color: #ffffff;
            border-radius: var(--card-border-radius);
            box-shadow: var(--card-shadow);
            margin-bottom: 20px;
            transition: all var(--transition-speed) ease;
            overflow: hidden;
            height: 100%;
            position: relative;
            border: none;
        }

        .feedback-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
        }

        .feedback-card .card-header {
            height: auto;
            padding: 15px;
            position: relative;
            border: none;
            background-color: #ffffff;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border-bottom: 1px solid #f1f5f9;
        }

        .feedback-card .card-header h5 {
            margin: 0;
            font-weight: 600;
            font-size: 1rem;
            color: #1e293b;
        }

        .feedback-card .card-header .date-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: #f1f5f9;
            color: #64748b;
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 15px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .feedback-card .card-body {
            padding: 15px;
            position: relative;
        }

        .feedback-info {
            margin-bottom: 10px;
            position: relative;
        }

        .feedback-info:last-child {
            margin-bottom: 0;
        }

        .feedback-info .info-label {
            color: #64748b;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .feedback-info .info-value {
            color: #334155;
            font-size: 0.85rem;
            font-weight: 400;
        }

        .star-rating {
            display: flex;
            gap: 3px;
        }

        .star-rating .star {
            color: #e2e8f0;
            font-size: 1rem;
            transition: color 0.2s ease;
        }

        .star-rating .star.filled {
            color: #f59e0b;
        }

        .recommend-badge {
            display: inline-flex;
            align-items: center;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            gap: 4px;
        }

        .recommend-badge.yes {
            background-color: #dcfce7;
            color: #16a34a;
        }

        .recommend-badge.no {
            background-color: #fee2e2;
            color: #dc2626;
        }

        .feedback-card .card-footer {
            background-color: #f8fafc;
            border-top: 1px solid #e2e8f0;
            padding: 10px 15px;
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            align-items: center;
        }

        .feedback-card .action-btn {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            color: white;
            transition: all 0.2s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            border: none;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .btn-view {
            background: #0ea5e9;
        }

        .btn-view:hover {
            background: #0284c7;
            transform: translateY(-2px);
        }

        .btn-edit {
            background: #8b5cf6;
        }

        .btn-edit:hover {
            background: #7c3aed;
            transform: translateY(-2px);
        }

        .btn-delete {
            background: #ef4444;
        }

        .btn-delete:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        /* Description avec limite de hauteur */
        .description-container {
            max-height: 60px;
            overflow: hidden;
            position: relative;
        }

        .description-container::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 20px;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0), rgba(255, 255, 255, 1));
            pointer-events: none;
        }

        /* User info with avatar */
        .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background-color: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #64748b;
            font-weight: 600;
            font-size: 0.8rem;
        }

        /* Barres de recherche et actions */
        .filter-header {
            background: white;
            border-radius: var(--card-border-radius);
            box-shadow: var(--card-shadow);
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .search-container {
            flex-grow: 1;
            max-width: 350px;
        }

        .search-container .input-group {
            border-radius: 30px;
            overflow: hidden;
            border: 1px solid #e2e8f0;
            background-color: #f8fafc;
        }

        .search-container .form-control {
            border: none;
            padding: 8px 15px;
            font-size: 0.85rem;
            background-color: transparent;
            height: 36px;
        }

        .search-container .input-group-text {
            background: #6366f1;
            border: none;
            color: white;
            padding: 0 15px;
        }

        .action-btns {
            display: flex;
            gap: 10px;
        }

        .btn-primary, .btn-secondary {
            height: 36px;
            border-radius: 30px;
            font-size: 0.8rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 0 15px;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
            border: none;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(99, 102, 241, 0.25);
        }

        .btn-secondary {
            background: var(--secondary-gradient);
            color: white;
            border: none;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(34, 197, 94, 0.25);
        }

        /* Sidebar de filtrage */
        .filter-sidebar {
            background: white;
            border-radius: var(--card-border-radius);
            box-shadow: var(--card-shadow);
            overflow: hidden;
            height: auto;
            margin-bottom: 20px;
        }

        .filter-sidebar-header {
            background: var(--primary-gradient);
            padding: 12px 15px;
            color: white;
        }

        .filter-sidebar-header h6 {
            margin: 0;
            font-weight: 600;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-sidebar-content {
            padding: 15px;
        }

        .filter-group {
            margin-bottom: 10px;
        }

        .filter-group:last-child {
            margin-bottom: 0;
        }

        .filter-group label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            color: #1e293b;
            font-size: 0.75rem;
        }

        .filter-group .form-select,
        .filter-group .form-control {
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 6px 8px;
            height: 32px;
            font-size: 0.8rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.02);
            background-color: #f8fafc;
        }

        .filter-group .btn-group {
            width: 100%;
            height: 30px;
            border-radius: 6px;
            overflow: hidden;
        }

        .filter-group .btn {
            padding: 0;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            border: 1px solid #e2e8f0;
            background-color: #ffffff;
            color: #475569;
            transition: all 0.2s ease;
        }

        .filter-group .btn.active {
            background: var(--primary-gradient);
            color: white;
            border-color: #6366f1;
        }

        .btn-reset {
            height: 30px;
            font-size: 0.75rem;
            padding: 0;
            background-color: #f1f5f9;
            color: #475569;
            border: none;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .btn-reset:hover {
            background-color: #e2e8f0;
        }

        .filter-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .filter-form .full-width {
            grid-column: 1 / -1;
        }

        /* Pagination */
        .pagination-container {
            margin-top: 30px;
            display: flex;
            justify-content: center;
        }

        .pagination {
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            background: white;
            padding: 3px;
        }

        .page-item .page-link {
            min-width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #475569;
            background: transparent;
            border: none;
            font-weight: 500;
            transition: all 0.2s ease;
            margin: 0 2px;
            border-radius: 16px;
            font-size: 0.85rem;
        }

        .page-item.active .page-link {
            background: #6366f1;
            color: white;
            box-shadow: 0 2px 4px rgba(99, 102, 241, 0.3);
        }

        .page-item .page-link:hover:not(.page-item.active .page-link) {
            background: #f1f5f9;
            color: #6366f1;
        }
        
        /* Barre de recherche */
        .search-input-container {
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 8px 15px 8px 35px;
            border-radius: 30px;
            border: 1px solid #e2e8f0;
            background-color: #f8fafc;
            font-size: 0.85rem;
        }
        
        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
        }
        
        /* Boutons d'action */
        .action-button {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 36px;
            padding: 0 16px;
            border-radius: 18px;
            font-weight: 500;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            gap: 8px;
            border: none;
        }
        
        .action-button.primary {
            background: var(--primary-gradient);
            color: white;
        }
        
        .action-button.secondary {
            background: var(--secondary-gradient);
            color: white;
        }
        
        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Modal */
        .modal-content {
            border-radius: var(--card-border-radius);
            overflow: hidden;
            border: none;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .modal-header {
            background: var(--primary-gradient);
            color: white;
            padding: 20px;
            border: none;
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            padding: 16px 24px;
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
        }

        .detail-item {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #f1f5f9;
        }

        .detail-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .detail-item .detail-label {
            font-size: 0.75rem;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .detail-item .detail-value {
            font-size: 1rem;
            color: #1e293b;
            font-weight: 500;
        }

        /* Responsive */
        @media (max-width: 992px) {
            .feedback-container {
                margin-left: 0;
            }
            .filter-header {
                flex-direction: column;
                align-items: stretch;
        }
            .search-container {
                max-width: 100%;
            }
        }

        @media (max-width: 768px) {
            .action-btns {
                width: 100%;
                justify-content: stretch;
            }
            .btn-primary, .btn-secondary {
                flex: 1;
            }
        }

        /* Nouvelle standardisation des filtres et statistiques */
        .filters-stats-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
            
        .filters-stats-row .filter-sidebar {
            flex: 1;
            margin-bottom: 0;
            max-width: 49%;
        }
        
        .filter-sidebar {
            background: white;
            border-radius: var(--card-border-radius);
            box-shadow: var(--card-shadow);
            overflow: hidden;
            height: auto;
            margin-bottom: 20px;
        }
        
        .filter-sidebar-header {
            background: var(--primary-gradient);
            padding: 10px 15px;
            color: white;
            display: flex;
            align-items: center;
        }
        
        .filter-sidebar-header h6 {
            margin: 0;
            font-weight: 600;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .filter-sidebar-content {
            padding: 12px;
        }
        
        /* Statistiques avec taille standardisée */
        .stats-container .progress {
            height: 6px;
            border-radius: 10px;
            margin-bottom: 8px;
            background-color: #f1f5f9;
        }
        
        .stats-section {
            margin-bottom: 15px;
        }
        
        .stats-section:last-child {
            margin-bottom: 0;
        }
        
        .stats-container .text-sm {
            font-size: 0.8rem;
            font-weight: 600;
            color: #334155;
            margin-bottom: 8px;
        }
        
        .stats-container .small {
            font-size: 0.75rem;
        }
        
        .chart-legend {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            color: #64748b;
            margin-top: 2px;
        }
        
        .stats-rec-container {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
            height: 20px;
        }
        
        .stats-rec-container:last-child {
            margin-bottom: 0;
        }
        
        .stats-rec-container .progress-container {
            width: 80px;
            flex-shrink: 0;
        }
        
        .stats-rec-container .badge-container {
            display: flex;
            align-items: center;
            gap: 5px;
            height: 20px;
        }
        
        .stats-rec-container .recommend-badge {
            padding: 2px 6px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            gap: 3px;
            height: 18px;
        }

        /* Couleurs des barres de progression */
        .progress-bar.bg-danger {
            background-color: #ef4444;
        }
        
        .progress-bar.bg-warning {
            background-color: #f59e0b;  
        }
        
        .progress-bar.bg-info {
            background-color: #3b82f6;
        }
        
        .progress-bar.bg-primary {
            background-color: #6366f1;
        }
        
        .progress-bar.bg-success {
            background-color: #10b981;
        }
        
        /* Filtres avec taille standardisée */
        .filter-group {
            margin-bottom: 10px;
        }
        
        .filter-group:last-child {
            margin-bottom: 0;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            color: #1e293b;
            font-size: 0.75rem;
        }
        
        .filter-group .form-select,
        .filter-group .form-control {
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 6px 8px;
            height: auto;
            font-size: 0.8rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.02);
            background-color: #f8fafc;
        }
        
        .filter-group .btn-group {
            width: 100%;
            height: 30px;
        }
        
        .filter-group .btn {
            padding: 0;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }
        
        .btn-reset {
            height: 30px;
            font-size: 0.75rem;
            padding: 0;
        }
        
        .filter-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .filter-form .full-width {
            grid-column: 1 / -1;
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .filters-stats-row {
                flex-direction: column;
            }
            
            .filters-stats-row .filter-sidebar {
                max-width: 100%;
            }
        }

        /* Nouvelle section de filtres inspirée de la capture d'écran */
        .filters-section {
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .filters-header {
            background-color: #7e57ff;
            color: white;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 500;
            font-size: 0.95rem;
        }
        
        .filters-header i {
            font-size: 1.1rem;
        }
        
        .filters-content {
            padding: 20px;
        }
        
        .filter-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .filter-row:last-child {
            margin-bottom: 0;
        }
        
        .filter-column {
            flex: 1;
        }
        
        .filter-full-width {
            width: 100%;
            margin-bottom: 20px;
        }
        
        .filter-label {
            font-weight: 500;
            font-size: 0.9rem;
            color: #333;
            margin-bottom: 8px;
        }
        
        .filter-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background-color: #f8f9fa;
            font-size: 0.9rem;
            color: #333;
        }
        
        .filter-date {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background-color: #f8f9fa;
            font-size: 0.9rem;
            color: #333;
        }
        
        /* Boutons de tri */
        .sort-label {
            font-weight: 500;
            font-size: 0.9rem;
            color: #333;
            margin-bottom: 8px;
        }
        
        .sort-buttons {
            display: flex;
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .sort-button {
            flex: 1;
            padding: 10px;
            border: none;
            background-color: #f8f9fa;
            color: #333;
            font-size: 0.85rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.2s ease;
        }
        
        .sort-button.active {
            background-color: #7e57ff;
            color: white;
        }
        
        .sort-button:first-child {
            border-right: 1px solid #e0e0e0;
        }
        
        .reset-button {
            width: 100%;
            padding: 10px 12px;
            border: none;
            border-radius: 8px;
            background-color: #f1f3f5;
            color: #555;
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s ease;
        }
        
        .reset-button:hover {
            background-color: #e9ecef;
        }

        /* Styles supplémentaires pour les notifications et animations */
        .feedback-item {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.3s ease, transform 0.3s ease, display 0.3s ease;
        }
        
        /* Notification système */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            max-width: 350px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .notification {
            display: flex;
            align-items: center;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 15px;
            opacity: 0;
            transform: translateX(30px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        .notification-icon {
            font-size: 1.5rem;
            margin-right: 15px;
        }
        
        .notification-success .notification-icon {
            color: #22c55e;
        }
        
        .notification-warning .notification-icon {
            color: #f59e0b;
        }
        
        .notification-info .notification-icon {
            color: #0ea5e9;
        }
        
        .notification-content {
            flex: 1;
            font-size: 0.9rem;
        }
        
        .notification-close {
            background: none;
            border: none;
            cursor: pointer;
            color: #64748b;
            font-size: 0.9rem;
            padding: 0;
            margin-left: 10px;
        }
        
        /* Modal de confirmation */
        .confirmation-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        
        .confirmation-modal.show {
            opacity: 1;
            visibility: visible;
        }
        
        .confirmation-content {
            background-color: white;
            width: 90%;
            max-width: 400px;
            border-radius: 16px;
            overflow: hidden;
            padding: 30px;
            text-align: center;
            transform: scale(0.8);
            transition: transform 0.3s ease;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .confirmation-modal.show .confirmation-content {
            transform: scale(1);
        }
        
        .confirmation-icon {
            width: 70px;
            height: 70px;
            margin: 0 auto 20px;
            background-color: #fee2e2;
            color: #ef4444;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
        }
        
        .confirmation-modal h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .confirmation-modal p {
            color: #64748b;
            margin-bottom: 25px;
        }
        
        .confirmation-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .confirmation-buttons button {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-cancel {
            background-color: #f1f5f9;
            color: #475569;
            border: none;
        }
        
        .btn-cancel:hover {
            background-color: #e2e8f0;
        }
        
        .btn-confirm {
            background-color: #ef4444;
            color: white;
            border: none;
        }
        
        .btn-confirm:hover {
            background-color: #dc2626;
        }
        
        /* Animation pour les étoiles */
        .star-rating .star.hover {
            color: #f59e0b;
            transform: scale(1.2);
            transition: color 0.2s ease, transform 0.2s ease;
        }

        /* Styles pour les cartes de même hauteur */
        .filters-section, .filter-sidebar {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .filters-content, .filter-sidebar-content {
            flex: 1;
            overflow: auto;
        }

        .collapse-btn {
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease;
            color: rgba(255,255,255,0.8);
        }

        .collapse-btn:hover {
            color: white;
        }

        .collapse-btn[aria-expanded="false"] .fa-chevron-up {
            transform: rotate(180deg);
        }

        /* S'assurer que les conteneurs ont la même hauteur */
        .row.equal-height {
            display: flex;
            flex-wrap: wrap;
        }

        .row.equal-height > [class*='col-'] {
            display: flex;
            flex-direction: column;
        }

        .col-md-6.d-flex {
            margin-bottom: 20px;
        }

        .filter-sidebar, .filters-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
            min-height: 400px; /* Hauteur minimale pour éviter qu'elles soient trop petites */
        }

        .filter-sidebar-content, .filters-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        /* Un peu d'espace au bas des contenus pour éviter que le contenu ne soit trop serré */
        .filter-sidebar-content .stats-section:last-child, 
        .filters-content form {
            margin-bottom: 15px;
        }
    </style>
{% endblock %}

{% block body %}
   <aside class="sidenav navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-3 bg-light" id="sidenav-main">
    <div class="sidenav-header">
        <a class="navbar-brand m-0" href="{{ path('admin_dashboard') }}">
            <img src="{{ asset('assets/img/EVENTORA.png') }}" class="navbar-brand-img" style="max-height: 40px;" alt="main_logo">
        </a>
    </div>
    <hr class="horizontal dark mt-0">
    <div class="collapse navbar-collapse w-auto" id="sidenav-collapse-main">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link {{ app.request.attributes.get('_route') == 'admin_dashboard' ? 'active' : '' }}" href="{{ path('admin_dashboard') }}">
                    <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="fas fa-tachometer-alt text-dark"></i>
                    </div>
                    <span class="nav-link-text ms-1">Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link {{ app.request.attributes.get('_route') == 'app_home_page' ? 'active' : '' }}" href="{{ path('app_home_page') }}">
                    <div class="icon icon-home icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="fas fa-tachometer-alt text-dark"></i>
                    </div>
                    <span class="nav-link-text ms-1">Home</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link dropdown-toggle {{ app.request.attributes.get('_route') starts with 'admin_reservations' ? 'active' : '' }}" href="#" data-bs-toggle="collapse" data-bs-target="#reservationsMenu" aria-expanded="{{ app.request.attributes.get('_route') starts with 'admin_reservations' ? 'true' : 'false' }}">
                    <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="fas fa-calendar-check text-dark"></i>
                    </div>
                    <span class="nav-link-text ms-1">Reservations</span>
                </a>
                <div class="collapse {{ app.request.attributes.get('_route') starts with 'admin_reservations' ? 'show' : '' }}" id="reservationsMenu">
                    <ul class="navbar-nav ms-3">
                        <li class="nav-item">
                            <a class="nav-link {{ app.request.attributes.get('_route') == 'admin_reservations_pack' ? 'active' : '' }}" href="{{ path('admin_reservations_pack') }}">
                                <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                                    <i class="fas fa-box text-dark"></i>
                                </div>
                                <span class="nav-link-text ms-1">Pack Reservations</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {{ app.request.attributes.get('_route') == 'admin_reservations_personnalise' ? 'active' : '' }}" href="{{ path('admin_reservations_personnalise') }}">
                                <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                                    <i class="fas fa-calendar-alt text-dark"></i>
                                </div>
                                <span class="nav-link-text ms-1">Personalized Reservations</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link dropdown-toggle {{ app.request.attributes.get('_route') starts with 'admin_reclamations' or app.request.attributes.get('_route') starts with 'admin_feedback' ? 'active' : '' }}" href="#" data-bs-toggle="collapse" data-bs-target="#complaintsMenu" aria-expanded="{{ app.request.attributes.get('_route') starts with 'admin_reclamations' or app.request.attributes.get('_route') starts with 'admin_feedback' ? 'true' : 'false' }}">
                    <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="fas fa-exclamation-triangle text-dark"></i>
                    </div>
                    <span class="nav-link-text ms-1">Complaints</span>
                </a>
                <div class="collapse {{ app.request.attributes.get('_route') starts with 'admin_reclamations' or app.request.attributes.get('_route') starts with 'admin_feedback' ? 'show' : '' }}" id="complaintsMenu">
                    <ul class="navbar-nav ms-3">
                        <li class="nav-item">
                            <a class="nav-link {{ app.request.attributes.get('_route') starts with 'admin_reclamations' ? 'active' : '' }}" href="{{ path('admin_reclamations') }}">
                                <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                                    <i class="fas fa-exclamation-circle text-dark"></i>
                                </div>
                                <span class="nav-link-text ms-1">Complaints</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {{ app.request.attributes.get('_route') starts with 'admin_feedback' ? 'active' : '' }}" href="{{ path('admin_feedback') }}">
                                <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                                    <i class="fas fa-comment-dots text-dark"></i>
                                </div>
                                <span class="nav-link-text ms-1">Feedback</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link dropdown-toggle {{ app.request.attributes.get('_route') starts with 'admin_membres' or app.request.attributes.get('_route') starts with 'admin_moderators' or app.request.attributes.get('_route') starts with 'admin_admins' ? 'active' : '' }}" href="#" data-bs-toggle="collapse" data-bs-target="#usersMenu" aria-expanded="{{ app.request.attributes.get('_route') starts with 'admin_membres' or app.request.attributes.get('_route') starts with 'admin_moderators' or app.request.attributes.get('_route') starts with 'admin_admins' ? 'true' : 'false' }}">
                    <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="fas fa-users text-dark"></i>
                    </div>
                    <span class="nav-link-text ms-1">Users</span>
                </a>
                <div class="collapse {{ app.request.attributes.get('_route') starts with 'admin_membres' or app.request.attributes.get('_route') starts with 'admin_moderators' or app.request.attributes.get('_route') starts with 'admin_admins' ? 'show' : '' }}" id="usersMenu">
                    <ul class="navbar-nav ms-3">
                        <li class="nav-item">
                            <a class="nav-link {{ app.request.attributes.get('_route') starts with 'admin_membres' ? 'active' : '' }}" href="{{ path('admin_membres') }}">
                                <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                                    <i class="fas fa-user-friends text-dark"></i>
                                </div>
                                <span class="nav-link-text ms-1">Members</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {{ app.request.attributes.get('_route') starts with 'app_agent_index' ? 'active' : '' }}" href="{{ path('app_agent_index') }}">
                                <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                                    <i class="fas fa-user-shield text-dark"></i>
                                </div>
                                <span class="nav-link-text ms-1">Agents</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link dropdown-toggle {{ app.request.attributes.get('_route') in ['admin_packs', 'admin_typepacks'] ? 'active' : '' }}" href="#" data-bs-toggle="collapse" data-bs-target="#packsMenu" aria-expanded="{{ app.request.attributes.get('_route') in ['admin_packs', 'admin_typepacks'] ? 'true' : 'false' }}">
                    <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="fas fa-box text-dark"></i>
                    </div>
                    <span class="nav-link-text ms-1">Packs</span>
                </a>
                <div class="collapse {{ app.request.attributes.get('_route') in ['admin_packs', 'admin_typepacks'] ? 'show' : '' }}" id="packsMenu">
                    <ul class="navbar-nav ms-3">
                        <li class="nav-item">
                            <a class="nav-link {{ app.request.attributes.get('_route') == 'admin_packs' ? 'active' : '' }}" href="{{ path('admin_packs') }}">
                                <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                                    <i class="fas fa-box-open text-dark"></i>
                                </div>
                                <span class="nav-link-text ms-1">Packs</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {{ app.request.attributes.get('_route') == 'admin_typepacks' ? 'active' : '' }}" href="{{ path('admin_typepacks') }}">
                                <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                                    <i class="fas fa-tags text-dark"></i>
                                </div>
                                <span class="nav-link-text ms-1">Pack Types</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link dropdown-toggle {{ app.request.attributes.get('_route') starts with 'admin_services' or app.request.attributes.get('_route') starts with 'admin_sponsors' ? 'active' : '' }}" href="#" data-bs-toggle="collapse" data-bs-target="#servicesMenu" aria-expanded="{{ app.request.attributes.get('_route') starts with 'admin_services' or app.request.attributes.get('_route') starts with 'admin_sponsors' ? 'true' : 'false' }}">
                    <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="fas fa-concierge-bell text-dark"></i>
                    </div>
                    <span class="nav-link-text ms-1">Services</span>
                </a>
                <div class="collapse {{ app.request.attributes.get('_route') starts with 'admin_services' or app.request.attributes.get('_route') starts with 'admin_sponsors' ? 'show' : '' }}" id="servicesMenu">
                    <ul class="navbar-nav ms-3">
                        <li class="nav-item">
                            <a class="nav-link {{ app.request.attributes.get('_route') starts with 'admin_services' ? 'active' : '' }}" href="{{ path('admin_services') }}">
                                <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                                    <i class="fas fa-tools text-dark"></i>
                                </div>
                                <span class="nav-link-text ms-1">Services</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {{ app.request.attributes.get('_route') starts with 'admin_sponsors' ? 'active' : '' }}" href="{{ path('admin_sponsors') }}">
                                <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                                    <i class="fas fa-handshake text-dark"></i>
                                </div>
                                <span class="nav-link-text ms-1">Partners</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="{{ path('app_logout') }}">
                    <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="fas fa-sign-out-alt text-dark"></i>
                    </div>
                    <span class="nav-link-text ms-1">Log out</span>
                </a>
            </li>
        </ul>
    </div>
</aside>
    <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg feedback-container">
        <nav class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl" id="navbarBlur">
            <div class="container-fluid py-1 px-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0 me-sm-6 me-5">
                        <li class="breadcrumb-item text-sm"><a class="opacity-5 text-dark" href="#">Pages</a></li>
                        <li class="breadcrumb-item text-sm"><a class="opacity-5 text-dark" href="{{ path('admin_reclamations') }}">Réclamations</a></li>
                        <li class="breadcrumb-item text-sm text-dark active" aria-current="page">Feedbacks</li>
                    </ol>
                    <h6 class="font-weight-bolder mb-0">
                        Liste des Feedbacks
                    </h6>
                </nav>
                <div class="collapse navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4" id="navbar">
                    <div class="ms-md-auto pe-md-3 d-flex align-items-center">
                        <!-- Barre de recherche dans la navigation -->
                    </div>
                    <ul class="navbar-nav justify-content-end">
                        <li class="nav-item d-flex align-items-center">
                            <a href="#" class="nav-link text-body font-weight-bold px-0">
                                <i class="fa fa-user me-sm-1"></i>
                                <span class="d-sm-inline d-none">{{ app.user.email ?? 'Utilisateur' }}</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container-fluid py-4">
            <!-- En-tête avec recherche et actions -->
            <div class="filter-header">
                <div class="search-input-container">
                    <input type="text" class="search-input" placeholder="Rechercher un feedback..." id="searchFeedback">
                    <span class="search-icon"><i class="fas fa-search"></i></span>
                    </div>
                <div class="action-btns">
                    <a href="{{ path('app_feedback_new') }}" class="action-button primary">
                        <i class="fas fa-plus"></i>
                        <span>Ajouter un feedback</span>
                    </a>
                    <a href="#" class="action-button secondary" onclick="exportToCSV()">
                        <i class="fas fa-file-export"></i>
                        <span>Exporter</span>
                    </a>
                </div>
            </div>

            <div class="row equal-height">
                <!-- Colonne de gauche: Statistiques -->
                <div class="col-md-6 d-flex">
                    <div class="filter-sidebar stats-container w-100">
                        <div class="filter-sidebar-header d-flex justify-content-between align-items-center">
                            <h6><i class="fas fa-chart-pie me-2"></i> Statistiques</h6>
                            <button class="btn btn-sm btn-link text-white collapse-btn" type="button" data-bs-toggle="collapse" data-bs-target="#statsCollapse" aria-expanded="true" aria-controls="statsCollapse">
                                <i class="fas fa-chevron-up"></i>
                            </button>
                        </div>
                        <div class="filter-sidebar-content collapse show" id="statsCollapse">
                            <!-- Score global et étoiles calculés dynamiquement -->
                            <div class="stats-section text-center mb-4">
                                {# 
                                  Note au développeur: 
                                  Le contrôleur doit passer tous les feedbacks dans la variable 'all_feedbacks',
                                  pas seulement ceux de la page courante, pour calculer correctement les statistiques.
                                #}
                                {% set feedbackCount = all_feedbacks|length %}
                                
                                <!-- Utiliser les stats précalculées par le contrôleur -->
                                {% set totalVotes = stats_total_votes %}
                                {% set countByRating = stats_count_by_rating %}
                                {% set avgScore = stats_avg_score %}
                                {% set filledStars = avgScore|round %}
                                
                                <!-- Nouvelle carte des statistiques simplifiée -->
                                <div class="stats-card p-4 bg-white rounded-3 shadow-sm">
                                    <!-- En-tête avec le total des feedbacks -->
                                    <div class="stats-header text-center mb-4">
                                        <h3 class="m-0 fw-bold" style="font-size: 1.8rem;">{{ totalVotes }}</h3>
                                        <p class="text-muted mb-0">Feedback{% if totalVotes > 1 %}s{% endif %} au total</p>
                                    </div>
                                    
                                    <!-- Note moyenne -->
                                    <div class="average-score text-center mb-4">
                                        <div class="score-value" style="font-size: 3rem; font-weight: 700; color: #0088ff; line-height: 1;">
                                            {{ avgScore }}
                                        </div>
                                        <div class="star-rating mb-2" style="justify-content: center; font-size: 1.5rem;">
                                                    {% for i in 1..5 %}
                                                <span class="star {% if i <= filledStars %}filled{% endif %}" style="color: {% if i <= filledStars %}#ffc107{% else %}#e2e8f0{% endif %};">★</span>
                                                    {% endfor %}
                                        </div>
                                        <p class="text-muted">Note moyenne</p>
                                    </div>
                                    
                                    <!-- Distribution des notes avec barres horizontales -->
                                    <div class="stats-distribution mt-4">
                                        <h6 class="fw-bold mb-3">Distribution des notes</h6>
                                        
                                        {% for rating in 5..1 %}
                                            {% set ratingCount = countByRating[rating]|default(0) %}
                                            {% set percentage = totalVotes > 0 ? (ratingCount / totalVotes * 100)|round : 0 %}
                                            
                                            <!-- Définir la couleur selon la note -->
                                            {% if rating == 5 %}
                                                {% set barColor = "#28a745" %} {# Vert foncé pour 5 étoiles #}
                                            {% elseif rating == 4 %}
                                                {% set barColor = "#5cb85c" %} {# Vert clair pour 4 étoiles #}
                                            {% elseif rating == 3 %}
                                                {% set barColor = "#ffc107" %} {# Jaune pour 3 étoiles #}
                                            {% elseif rating == 2 %}
                                                {% set barColor = "#fd7e14" %} {# Orange pour 2 étoiles #}
                                {% else %}
                                                {% set barColor = "#dc3545" %} {# Rouge pour 1 étoile #}
                                {% endif %}
                                            
                                            <div class="rating-row d-flex align-items-center mb-3">
                                                <!-- Nombre d'étoiles à gauche -->
                                                <div class="rating-stars" style="width: 100px; text-align: left;">
                                                    <div style="display: flex; align-items: center;">
                                                        <span style="font-weight: 600; font-size: 1rem; min-width: 15px; margin-right: 8px;">{{ rating }}</span>
                                                        {% for i in 1..rating %}
                                                            <span style="color: #ffc107; font-size: 0.9rem;">★</span>
                                {% endfor %}
                                                    </div>
                                                </div>
                                                
                                                <!-- Barre de progression -->
                                                <div class="progress flex-grow-1 mx-2" style="height: 18px; border-radius: 20px; background-color: #f1f5f9;">
                                                    <div class="progress-bar" 
                                                         style="width: {{ percentage }}%; border-radius: 20px; min-width: {{ ratingCount > 0 ? '30px' : '0' }}; background-color: {{ barColor }};">
                                                        {% if ratingCount > 0 and percentage >= 15 %}
                                                            <span style="font-size: 0.8rem; color: white; padding: 0 8px; line-height: 18px;">{{ percentage }}%</span>
                    {% endif %}
                                                    </div>
                </div>

                                                <!-- Compteur à droite -->
                                                <div style="width: 100px; text-align: right; font-size: 0.9rem; color: #333; white-space: nowrap;">
                                                    <span style="font-weight: 600; color: #333;">{{ ratingCount }}</span>
                                                    <span style="color: #6c757d; margin-left: 4px;">({{ percentage }}%)</span>
                                                </div>
                                            </div>
                                        {% endfor %}
                                        
                                        <!-- Ligne de total -->
                                        <div class="total-row d-flex align-items-center mt-4 pt-3" style="border-top: 1px solid #e2e8f0;">
                                            <div style="width: 100px; text-align: left;">
                                                <span style="font-weight: 600; font-size: 1rem;">Total</span>
                                            </div>
                                            <div class="flex-grow-1 mx-2"></div>
                                            <div style="width: 100px; text-align: right; font-size: 1rem; font-weight: 600; color: #333;">
                                                {{ totalVotes }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Colonne de droite: Filtres -->
                <div class="col-md-6 d-flex">
                    <!-- Nouvelle section de filtres inspirée de la capture d'écran -->
                    <div class="filters-section w-100">
                        <div class="filters-header d-flex justify-content-between align-items-center">
                            <div>
                                <i class="fas fa-filter"></i>
                                <span>Filtres et Tri</span>
                            </div>
                            <button class="btn btn-sm btn-link text-white collapse-btn" type="button" data-bs-toggle="collapse" data-bs-target="#filtersCollapse" aria-expanded="true" aria-controls="filtersCollapse">
                                <i class="fas fa-chevron-up"></i>
                            </button>
                        </div>
                        <div class="filters-content collapse show" id="filtersCollapse">
                            <form method="get" action="{{ path('admin_feedback') }}">
                                <!-- Première ligne: Utilisateur et Note -->
                                <div class="filter-row">
                                    <div class="filter-column">
                                        <div class="filter-label">Utilisateur</div>
                                        <select name="user_filter" id="user_filter" class="filter-control" onchange="this.form.submit()">
                                            <option value="">Tous</option>
                                    {% for user in users %}
                                        <option value="{{ user }}" {{ selected_user == user ? 'selected' : '' }}>{{ user }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                                    <div class="filter-column">
                                        <div class="filter-label">Note</div>
                                        <select name="rating_filter" id="rating_filter" class="filter-control" onchange="this.form.submit()">
                                            <option value="">Toutes</option>
                                    {% for i in 1..5 %}
                                                <option value="{{ i }}" {{ selected_rating == i ? 'selected' : '' }}>{{ i }} ★</option>
                                    {% endfor %}
                                </select>
                            </div>
                            </div>
                                
                                <!-- Deuxième ligne: Date -->
                                <div class="filter-full-width">
                                    <div class="filter-label">Date</div>
                                    <input type="date" name="date_filter" id="date_filter" class="filter-date" value="{{ selected_date }}" onchange="this.form.submit()">
                                </div>
                                
                                <!-- Troisième ligne: Tris -->
                                <div class="filter-row">
                                    <div class="filter-column">
                                        <div class="sort-label">Trier par Date</div>
                                        <div class="sort-buttons">
                                    <a href="{{ path('admin_feedback', {'sort_by': 'date', 'sort_order': 'asc', 'user_filter': selected_user, 'date_filter': selected_date, 'rating_filter': selected_rating, 'page': current_page}) }}"
                                               class="sort-button {{ sort_by == 'date' and sort_order == 'asc' ? 'active' : '' }}">
                                                <i class="fas fa-arrow-up"></i> Asc
                                    </a>
                                    <a href="{{ path('admin_feedback', {'sort_by': 'date', 'sort_order': 'desc', 'user_filter': selected_user, 'date_filter': selected_date, 'rating_filter': selected_rating, 'page': current_page}) }}"
                                               class="sort-button {{ sort_by == 'date' and sort_order == 'desc' ? 'active' : '' }}">
                                                <i class="fas fa-arrow-down"></i> Desc
                                    </a>
                                </div>
                            </div>
                                    <div class="filter-column">
                                        <div class="sort-label">Trier par Note</div>
                                        <div class="sort-buttons">
                                    <a href="{{ path('admin_feedback', {'sort_by': 'Vote', 'sort_order': 'asc', 'user_filter': selected_user, 'date_filter': selected_date, 'rating_filter': selected_rating, 'page': current_page}) }}"
                                               class="sort-button {{ sort_by == 'Vote' and sort_order == 'asc' ? 'active' : '' }}">
                                                <i class="fas fa-arrow-up"></i> Asc
                                    </a>
                                    <a href="{{ path('admin_feedback', {'sort_by': 'Vote', 'sort_order': 'desc', 'user_filter': selected_user, 'date_filter': selected_date, 'rating_filter': selected_rating, 'page': current_page}) }}"
                                               class="sort-button {{ sort_by == 'Vote' and sort_order == 'desc' ? 'active' : '' }}">
                                                <i class="fas fa-arrow-down"></i> Desc
                                    </a>
                                </div>
                            </div>
                                </div>
                                
                                <!-- Quatrième ligne: Bouton de réinitialisation -->
                                <div class="filter-row" style="margin-top: 20px;">
                                    <a href="{{ path('admin_feedback') }}" class="reset-button">
                                        <i class="fas fa-undo"></i> Réinitialiser
                                    </a>
                                </div>
                            </form>
                            </div>
                    </div>
                </div>
            </div>

                <!-- Liste des feedbacks -->
            <div class="row mt-4">
                            <div class="col-12">
                    <div class="row g-4" id="feedbackList">
                                {% if feedbacks|length > 0 %}
                                    {% for feedback in feedbacks %}
                            <div class="col-lg-4 col-md-6 feedback-item">
                                <div class="feedback-card">
                                    <div class="card-header">
                                        <h5>Feedback #{{ feedback.ID }}</h5>
                                        <span class="date-badge">
                                            <i class="far fa-calendar-alt me-1"></i>{{ feedback.date ? feedback.date|date('d/m/Y') : 'Non définie' }}
                                        </span>
                                </div>
                                    <div class="card-body">
                                        <div class="feedback-info">
                                            <div class="info-label">Utilisateur</div>
                                            <div class="info-value user-info">
                                                <div class="user-avatar">
                                                    {% if feedback.membre %}
                                                        {{ feedback.membre.email|slice(0, 1)|upper }}
                                                    {% else %}
                                                        A
                                                    {% endif %}
                            </div>
                                                <span>{{ feedback.membre ? feedback.membre.email : 'Anonyme' }}</span>
                            </div>
                                        </div>
                                        <div class="feedback-info">
                                            <div class="info-label">Note</div>
                                            <div class="info-value">
                                                <span class="star-rating">
                                                    {% for i in 1..5 %}
                                                        <span class="star {% if i <= feedback.Vote %}filled{% endif %}">★</span>
                                                    {% endfor %}
                                                </span>
                                            </div>
                                        </div>
                                        <div class="feedback-info">
                                            <div class="info-label">Recommandé</div>
                                            <div class="info-value">
                                                <span class="recommend-badge {{ feedback.recommend|lower == 'oui' ? 'yes' : 'no' }}">
                                                    {% if feedback.recommend|lower == 'oui' %}
                                                        <i class="fas fa-thumbs-up"></i> Oui
                                                    {% else %}
                                                        <i class="fas fa-thumbs-down"></i> Non
                                                    {% endif %}
                                                </span>
                                            </div>
                                        </div>
                                        <div class="feedback-info">
                                            <div class="info-label">Description</div>
                                            <div class="info-value description-container">
                                                {{ feedback.description }}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-footer">
                                        <button type="button" class="action-btn btn-view" data-bs-toggle="modal" data-bs-target="#feedbackModal-{{ feedback.ID }}" title="Voir les détails">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <a href="{{ path('admin_feedback_edit_recommend', {'id': feedback.ID}) }}" class="action-btn btn-edit" title="Modifier">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <button type="button" class="action-btn btn-delete" data-form-id="{{ feedback.ID }}" title="Supprimer">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                                <form id="delete-form-{{ feedback.ID }}" method="post" action="{{ path('admin_feedback_delete', {'id': feedback.ID}) }}" style="display: none;">
                                                    <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ feedback.ID) }}">
                        </form>
                    </div>
                                </div>
                            </div>
                                    {% endfor %}
                                {% else %}
                        <div class="col-12">
                            <div class="alert alert-info text-center p-4 rounded-3">
                                <i class="fas fa-info-circle fa-2x mb-3"></i>
                                <p class="mb-0">Aucun feedback trouvé.</p>
                            </div>
                        </div>
                                {% endif %}
                    </div>

                    <!-- Pagination -->
                    {% if total_pages > 1 %}
                        <div class="pagination-container">
                            <ul class="pagination">
                                <li class="page-item {{ current_page == 1 ? 'disabled' : '' }}">
                                    <a class="page-link" href="{{ path('admin_feedback', {'page': current_page - 1, 'sort_by': sort_by, 'sort_order': sort_order, 'user_filter': selected_user, 'date_filter': selected_date, 'rating_filter': selected_rating}) }}" aria-label="Précédent">
                                        <i class="fas fa-chevron-left"></i>
                                    </a>
                                </li>
                                {% for i in 1..total_pages %}
                                    <li class="page-item {{ current_page == i ? 'active' : '' }}">
                                        <a class="page-link" href="{{ path('admin_feedback', {'page': i, 'sort_by': sort_by, 'sort_order': sort_order, 'user_filter': selected_user, 'date_filter': selected_date, 'rating_filter': selected_rating}) }}">{{ i }}</a>
                                    </li>
                                {% endfor %}
                                <li class="page-item {{ current_page == total_pages ? 'disabled' : '' }}">
                                    <a class="page-link" href="{{ path('admin_feedback', {'page': current_page + 1, 'sort_by': sort_by, 'sort_order': sort_order, 'user_filter': selected_user, 'date_filter': selected_date, 'rating_filter': selected_rating}) }}" aria-label="Suivant">
                                        <i class="fas fa-chevron-right"></i>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Modales pour détails -->
            {% for feedback in feedbacks %}
                <div class="modal fade" id="feedbackModal-{{ feedback.ID }}" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Feedback #{{ feedback.ID }}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
                            </div>
                            <div class="modal-body">
                                <div class="detail-item">
                                    <div class="detail-label">Utilisateur</div>
                                    <div class="detail-value user-info">
                                        <div class="user-avatar">
                                            {% if feedback.membre %}
                                                {{ feedback.membre.email|slice(0, 1)|upper }}
                                            {% else %}
                                                A
                                            {% endif %}
                                        </div>
                                        <span>{{ feedback.membre ? feedback.membre.email : 'Anonyme' }}</span>
                                    </div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Note</div>
                                    <div class="detail-value">
                                    <span class="star-rating">
                                        {% for i in 1..5 %}
                                            <span class="star {% if i <= feedback.Vote %}filled{% endif %}">★</span>
                                        {% endfor %}
                                    </span>
                                    </div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Date</div>
                                    <div class="detail-value">{{ feedback.date ? feedback.date|date('d/m/Y') : 'Non définie' }}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Recommandé</div>
                                    <div class="detail-value">
                                    <span class="recommend-badge {{ feedback.recommend|lower == 'oui' ? 'yes' : 'no' }}">
                                            {% if feedback.recommend|lower == 'oui' %}
                                                <i class="fas fa-thumbs-up"></i> Oui
                                            {% else %}
                                                <i class="fas fa-thumbs-down"></i> Non
                                            {% endif %}
                                    </span>
                                    </div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Description</div>
                                    <div class="detail-value">{{ feedback.description }}</div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-light" data-bs-dismiss="modal">Fermer</button>
                                <a href="{{ path('admin_feedback_edit_recommend', {'id': feedback.ID}) }}" class="btn btn-primary">Modifier</a>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </main>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Animation d'apparition des cartes au chargement
            const feedbackItems = document.querySelectorAll('.feedback-item');
            feedbackItems.forEach((item, index) => {
                setTimeout(() => {
                    item.style.opacity = '1';
                    item.style.transform = 'translateY(0)';
                }, 100 * index);
            });

            // Recherche en temps réel améliorée
        document.getElementById('searchFeedback').addEventListener('input', function(e) {
            const searchText = e.target.value.toLowerCase();
                const feedbackItems = document.querySelectorAll('.feedback-item');
                let noResults = true;
                
                feedbackItems.forEach(item => {
                    const description = item.querySelector('.feedback-info:last-child .info-value').textContent.toLowerCase();
                    const email = item.querySelector('.user-info span').textContent.toLowerCase();
                    const id = item.querySelector('.card-header h5').textContent.toLowerCase();
                    
                    if (description.includes(searchText) || email.includes(searchText) || id.includes(searchText)) {
                        item.style.display = '';
                        item.style.opacity = '1';
                        item.style.transform = 'translateY(0)';
                        noResults = false;
                    } else {
                        item.style.opacity = '0';
                        item.style.transform = 'translateY(20px)';
                        setTimeout(() => {
                            if (item.style.opacity === '0') {
                                item.style.display = 'none';
                            }
                        }, 300);
                    }
                });

                // Afficher ou masquer le message "aucun résultat"
                let noResultsMsg = document.getElementById('noSearchResults');
                if (noResults && searchText.length > 0) {
                    if (!noResultsMsg) {
                        noResultsMsg = document.createElement('div');
                        noResultsMsg.id = 'noSearchResults';
                        noResultsMsg.className = 'col-12 mt-4';
                        noResultsMsg.innerHTML = `
                            <div class="alert alert-info text-center p-4 rounded-3">
                                <i class="fas fa-search fa-2x mb-3"></i>
                                <p class="mb-0">Aucun feedback ne correspond à votre recherche "${searchText}".</p>
                            </div>
                        `;
                        document.getElementById('feedbackList').appendChild(noResultsMsg);
                    } else {
                        noResultsMsg.querySelector('p').textContent = `Aucun feedback ne correspond à votre recherche "${searchText}".`;
                    }
                } else if (noResultsMsg) {
                    noResultsMsg.remove();
                }
            });

            // Visualisation interactive des étoiles dans les modales
            document.querySelectorAll('.modal .star-rating .star').forEach(star => {
                star.addEventListener('mouseenter', function() {
                    const stars = this.parentElement.querySelectorAll('.star');
                    const index = Array.from(stars).indexOf(this);
                    
                    stars.forEach((s, i) => {
                        if (i <= index) {
                            s.classList.add('hover');
                        } else {
                            s.classList.remove('hover');
                        }
                    });
                });
                
                star.addEventListener('mouseleave', function() {
                    this.parentElement.querySelectorAll('.star').forEach(s => {
                        s.classList.remove('hover');
                    });
                });
            });

            // Exportation en CSV améliorée avec notification
            window.exportToCSV = function() {
                const feedbacks = document.querySelectorAll('.feedback-item');
            let csvContent = 'ID,Utilisateur,Note,Description,Date,Recommandé\n';
                let count = 0;
                
                feedbacks.forEach(feedback => {
                    if (feedback.style.display !== 'none') {
                        count++;
                        const id = feedback.querySelector('.card-header h5').textContent.replace('Feedback #', '');
                        const user = feedback.querySelector('.user-info span').textContent.trim().replace(/,/g, ';');
                        const rating = feedback.querySelector('.star-rating .filled').length;
                        const description = feedback.querySelector('.feedback-info:nth-child(4) .info-value').textContent.trim().replace(/,/g, ';');
                        const date = feedback.querySelector('.date-badge').textContent.trim();
                        const recommend = feedback.querySelector('.recommend-badge').textContent.trim();
                        
                    csvContent += `${id},${user},${rating},${description},${date},${recommend}\n`;
                }
            });
                
                if (count > 0) {
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
                    link.download = 'feedbacks_export_' + new Date().toISOString().slice(0, 10) + '.csv';
            link.click();
                    
                    // Afficher une notification de succès
                    showNotification(`${count} feedbacks exportés avec succès.`, 'success');
                } else {
                    showNotification('Aucun feedback à exporter.', 'warning');
                }
            };

            // Système de notification
            window.showNotification = function(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                notification.innerHTML = `
                    <div class="notification-icon">
                        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                    </div>
                    <div class="notification-content">${message}</div>
                    <button class="notification-close" onclick="this.parentElement.remove()">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                // Ajouter au DOM
                let container = document.querySelector('.notification-container');
                if (!container) {
                    container = document.createElement('div');
                    container.className = 'notification-container';
                    document.body.appendChild(container);
                }
                
                container.appendChild(notification);
                
                // Animer et retirer après délai
                setTimeout(() => {
                    notification.classList.add('show');
                }, 10);
                
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        notification.remove();
                    }, 300);
                }, 5000);
            };

            // Confirmation de suppression avec modal personnalisé
            document.querySelectorAll('.btn-delete').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    const formId = this.getAttribute('data-form-id') || this.getAttribute('onclick').match(/delete-form-(\d+)/)[1];
                    
                    // Créer une boîte de dialogue de confirmation personnalisée
                    const modal = document.createElement('div');
                    modal.className = 'confirmation-modal';
                    modal.innerHTML = `
                        <div class="confirmation-content">
                            <div class="confirmation-icon">
                                <i class="fas fa-trash-alt"></i>
                            </div>
                            <h3>Confirmer la suppression</h3>
                            <p>Êtes-vous sûr de vouloir supprimer ce feedback ? Cette action est irréversible.</p>
                            <div class="confirmation-buttons">
                                <button class="btn-cancel">Annuler</button>
                                <button class="btn-confirm">Supprimer</button>
                            </div>
                        </div>
                    `;
                    
                    document.body.appendChild(modal);
                    
                    // Animations
                    setTimeout(() => {
                        modal.classList.add('show');
                    }, 10);
                    
                    // Gestionnaires d'événements
                    modal.querySelector('.btn-cancel').addEventListener('click', () => {
                        modal.classList.remove('show');
                        setTimeout(() => {
                            modal.remove();
                        }, 300);
                    });
                    
                    modal.querySelector('.btn-confirm').addEventListener('click', () => {
                        document.getElementById(`delete-form-${formId}`).submit();
                    });
                    
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.classList.remove('show');
                            setTimeout(() => {
                                modal.remove();
                            }, 300);
                        }
                    });
                });
            });
        });
    </script>
{% endblock %}